var GUI={DBentry:["","",""],DBupdate:false,activePlayer:"",browsemode:"file",checkvol:0,currentDBpos:[0,0,0,0,0,0,0,0,0,0,0],currentDBpath:["","","","","","","","","","",""],currentalbum:"",currentartist:"",currentsong:"",currentknob:null,currentpath:"",json:0,libraryhome:"",forceGUIupdate:false,maxvol:100,minvol:0,mode:"websocket",noticeUI:{},playlist:null,plugin:"",state:"",old_state:"none",stepVolumeDelta:0,stepVolumeInt:0,stream:"",visibility:"visible",vol_changed_local:0,volume:null,clientUUID:null,mainArtURL:"",smallArtURL:"",bigArtURL:"",song_lyrics:"",time:0,elapsed:0,consume:0,file:""};function generateUUID(){var s=(new Date).getTime();var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=(s+Math.random()*16)%16|0;s=Math.floor(s/16);return(e=="x"?a:a&3|8).toString(16)});return e}function sendCmd(e){$.ajax({type:"GET",url:"/command/?cmd="+e+"&clientUUID="+GUI.clientUUID,cache:false})}function checkWebSocket(){if(window.WebSocket){return"websocket"}else{return"longpolling"}}function checkWorkers(){if(window.Worker&&window.Blob||Modernizr.webworkers&&Modernizr.blobconstructor){return true}else{return false}}function parsePath(e){var a=e&&e.length?e.lastIndexOf("/"):0;var s="";if(a&&a!==-1){s=e.slice(0,a)}return s}var idleTime=0;var viewScreenSaver=0;var widthScreenSaver=0;var isLocalHost=0;var SStime=-1;$(document).ready(function(){GUI.clientUUID=generateUUID();if($("#section-index").length){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"){isLocalHost=1;SStime=localSStime}else{isLocalHost=0;SStime=remoteSStime}if(SStime>=0){var e=setInterval(timerIncrement,1e3)}$(this).on("mousemove click keypress",function(e){idleTime=0;if(viewScreenSaver){$(".tab-content").show("slow");if(smallScreenSaver&&isLocalHost){$(".small-screen-saver-content").hide("slow")}else{$(".screen-saver-content").hide("slow")}$("#menu-bottom").show("slow");$("#menu-top").show("slow");viewScreenSaver=0}})}});function timerIncrement(){if($("#section-index").length&&GUI.state==="play"&&!$("#panel-sx").hasClass("active")&&!$("#panel-dx").hasClass("active")){idleTime=idleTime+1}else{idleTime=0}if(idleTime>SStime){removePlayerScrollbars();$(".tab-content").hide("slow");if(smallScreenSaver&&isLocalHost){$(".small-screen-saver-content").show("slow")}else{$(".screen-saver-content").show("slow")}$("#menu-bottom").hide("slow");$("#menu-top").hide("slow");viewScreenSaver=1}}function checkPlayerState(){if($("#playback").hasClass("active")){removePlayerScrollbars()}else{addPlayerScrollbars()}}function removePlayerScrollbars(){$("html").addClass("disable-scrollbar-0");$("#section-index").addClass("disable-scrollbar-1");$("#section-index").addClass("disable-scrollbar-2")}function addPlayerScrollbars(){$("html").removeClass("disable-scrollbar-0");$("#section-index").removeClass("disable-scrollbar-1");$("#section-index").removeClass("disable-scrollbar-2")}function refreshTimer(e,a=null,s){var t=$("#countdown-display");if(typeof t.countdown!=="undefined"){t.countdown("destroy");t.countdown({since:s!=="stop"||s!==undefined?-e:0,compact:true,format:"MS"});if(s==="play"){t.countdown("resume")}else{t.countdown("pause")}}var i=$("#countdown-display-ss");if(typeof i.countdown!=="undefined"){i.countdown("destroy");i.countdown({since:s!=="stop"||s!==undefined?-e:0,compact:true,format:"MS"});if(s==="play"){i.countdown("resume")}else{i.countdown("pause")}}var o=$("#countdown-display-sss");if(typeof o.countdown!=="undefined"){o.countdown("destroy");o.countdown({since:s!=="stop"||s!==undefined?-e:0,compact:true,format:"MS"});if(s==="play"){o.countdown("resume")}else{o.countdown("pause")}}}function refreshKnob(){if(typeof GUI.json.song_percent!=="undefined"){var e=parseInt(GUI.json.song_percent)*10}if(typeof GUI.json.time!=="undefined"){var a=parseInt(GUI.json.time);var s=parseInt(1e3/a)}var t=$(".countdown-amount").html();var i=$("#time");window.clearInterval(GUI.currentKnob);i.val(e,false).trigger("update");if(GUI.state==="play"){GUI.currentKnob=setInterval(function(){e=e+(GUI.visibility!=="visible"?s:1);i.val(e,false).trigger("update")},a)}}function timeConvert(e){var a=Math.floor(e/60);e-=a*60;var s=a<10?"0"+a:a;var t=e<10?"0"+e:e;return s+":"+t}function timeConvert2(e){var a=Math.floor(e/3600);var s=Math.floor((e-a*3600)/60);e=Math.floor(e-a*3600-s*60);if(a>0){if(a<10){a="0"+a}a+=":"}else{a=""}if(s<10){s="0"+s}if(e<10){e="0"+e}return a+s+":"+e}function timeConvert3(e){var a=Math.floor(e/3600);var s=Math.floor((e-a*3600)/60);e=Math.floor(e-a*3600-s*60);if(a>0){if(a<10){a="0"+a+"h "}a+="h "}else{a=""}if(s<10){s="0"+s}if(e<10){e="0"+e}return a+s+"m "+e+"s"}function countdownRestart(e){var a=$("#countdown-display").countdown("destroy");a.countdown({since:-e,compact:true,format:"MS"});var s=$("#countdown-display-ss").countdown("destroy");s.countdown({since:-e,compact:true,format:"MS"});var t=$("#countdown-display-sss").countdown("destroy");t.countdown({since:-e,compact:true,format:"MS"})}function reset_vol_changed_local(){GUI.vol_changed_local=0}function setvol(e){GUI.volume=e;$("#volumemute").removeClass("btn-primary");sendCmd("setvol "+e);if(GUI.vol_changed_local===0){setInterval(reset_vol_changed_local,5e3);GUI.vol_changed_local=1}}function volumeStepCalc(a){var s=0;var e=a;GUI.volume=parseInt($("#volume").val());var t=function i(e){s++;if(a==="up"){GUI.stepVolumeDelta=parseInt(GUI.volume)+s}else if(a==="dn"){GUI.stepVolumeDelta=parseInt(GUI.volume)-s}$("#volume").val(GUI.stepVolumeDelta).trigger("change")};t();GUI.stepVolumeInt=window.setInterval(function(){t()},200)}function volumeStepSet(){window.clearInterval(GUI.stepVolumeInt);setvol(GUI.stepVolumeDelta)}function customScroll(e,a,s){if(typeof s==="undefined"){s=500}var t=49;var i=parseInt($(window).height()/2);var o=$(window).scrollTop();var n=0;var l=0;if(e==="db"){n=parseInt(a*t-i);l=n}else if(e==="pl"){n=parseInt((a+2)*t-i);l=Math.abs(n-o);l=(n>o?"+":"-")+"="+l+"px";$("#playlist-entries").find("li").eq(a).addClass("active")}$.scrollTo(n>0?l:0,s)}function randomScrollPL(){var e=$(".playlist li").size();var a=1+Math.floor(Math.random()*e);customScroll("pl",a)}function randomScrollDB(){var e=$(".database li").size();var a=1+Math.floor(Math.random()*e);customScroll("db",a)}function toggleLoader(e){if(e==="close"){$("#loader").addClass("hide")}else{if($("#section-dev").length){$("#loader").addClass("hide");new PNotify({title:"Warning",text:"The loading layer (spinning arrows) points to a socket error",icon:"fa fa-exclamation-circle"})}else{$("#loader").removeClass("hide")}}}function customNotify(e){if(e.custom==="kernelswitch"){if(GUI.noticeUI.kernelswitch!==undefined){GUI.noticeUI.kernelswitch.remove()}GUI.noticeUI.kernelswitch=new PNotify({title:"title"in e?e.title:"[missing title]",text:"text"in e?e.text:"[missing text]",icon:"fa fa-refresh",hide:false,confirm:{confirm:true,buttons:[{text:e.btntext,addClass:"btn-default btn-block  uppercase",click:function(){$.post("/settings/",{syscmd:"reboot"});toggleLoader()}},{text:"Cancel",addClass:"hide"}]},buttons:{closer:false,sticker:false}})}}function renderMSG(e){var a=e[0];if("custom"in a&&a.custom!==null){customNotify(a);return}var s={title:"title"in a?a.title:"[missing title]",text:"text"in a?a.text:"[missing text]",icon:a.icon===undefined?"fa fa-check":a.icon,opacity:a.opacity===undefined?.9:a.opacity,hide:a.hide===undefined&&a.permanotice===undefined,buttons:{closer:a.permanotice===undefined,sticker:a.permanotice===undefined},delay:a.delay===undefined?8e3:a.delay,mouse_reset:false};if("permanotice"in a){if(GUI.noticeUI[a.permanotice]===undefined){GUI.noticeUI[a.permanotice]=new PNotify(s)}else{if("permaremove"in a){GUI.noticeUI[a.permanotice].remove();GUI.noticeUI[a.permanotice]=undefined}else{GUI.noticeUI[a.permanotice].open()}}}else{new PNotify(s)}$(".ui-pnotify").on("click",".ui-pnotify-text",function(){$(this).parent().parent().remove()})}function sortOrder(e){var a=$("#"+e).index();e=parseInt(e.replace("pl-",""));sendCmd("moveid "+e+" "+a)}function loadingSpinner(e,a){if(a==="hide"){if(e==="db"){$("#spinner-db").addClass("hide")}if(e==="pl"){$("#spinner-pl").addClass("hide")}}else{if(e==="db"){$("#spinner-db").removeClass("hide")}if(e==="pl"){$("#spinner-pl").removeClass("hide")}}}function setPlaybackSource(){if(typeof GUI.libraryhome.ActivePlayer!="undefined"){var e=GUI.libraryhome.ActivePlayer;$("#overlay-playsource-open button").text(e);$("#overlay-playsource a").addClass("inactive");var a=e.toLowerCase();$("#playsource-"+a).removeClass("inactive")}setUIbuttons(e);$("#playlist-entries").removeClass(function(e,a){return(a.match(/(^|\s)playlist-\S+/g)||[]).join(" ")}).addClass("playlist-"+a);$("#pl-manage").removeClass(function(e,a){return(a.match(/(^|\s)pl-manage-\S+/g)||[]).join(" ")}).addClass("pl-manage-"+a)}function setUIbuttons(e){if(e==="Airplay"||e==="SpotifyConnect"||e==="Bluetooth"){$("#stop").addClass("disabled");$("#play").addClass("disabled");$("#next").addClass("hide");$("#previous").addClass("hide")}else{$("#stop").removeClass("disabled");$("#play").removeClass("disabled");if(GUI.state=="stop"){$("#previous").addClass("hide");$("#next").addClass("hide")}else{if(GUI.consume==="1"){$("#previous").addClass("hide");$("#next").removeClass("hide")}else{$("#previous").removeClass("hide");$("#next").removeClass("hide")}}if(typeof GUI.libraryhome.CDinput!=="undefined"&&typeof GUI.libraryhome.CDinput.status!=="undefined"&&Object.keys(GUI.libraryhome.CDinput.status).length){$("#eject").removeClass("hide");$("#eject").removeClass("disabled")}else{$("#eject").addClass("hide")}}if($("#section-index").length){document.getElementById("volume").readOnly=true;if(e==="Airplay"||e==="SpotifyConnect"||e==="Bluetooth"){$("#volume-knob").addClass("disabled");$("#volume-knob").addClass("nomixer");$("#volume-knob button").prop("disabled",true);$("#volume").addClass("disabled");$("#volume-knob").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volume").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volumedn").addClass("disabled");$("#volumemute").addClass("disabled");$("#volumeup").addClass("disabled");$("#repeat").addClass("hide");$("#random").addClass("hide");$("#single").addClass("hide")}else{if(GUI.stream){$("#repeat").addClass("hide");$("#random").addClass("hide");$("#single").addClass("hide")}else{$("#repeat").removeClass("hide");$("#random").removeClass("hide");$("#single").removeClass("hide")}if(typeof GUI.json.volume==="undefined"){$("#volume-knob").addClass("disabled");$("#volume-knob").addClass("nomixer");$("#volume-knob button").prop("disabled",true);$("#volume").addClass("disabled");$("#volume-knob").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volume").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volumedn").addClass("hide");$("#volumemute").addClass("hide");$("#volumeup").addClass("hide")}else{$("#volume-knob").removeClass("disabled");$("#volume-knob").removeClass("nomixer");$("#volume-knob button").prop("disabled",false);$("#volume").removeClass("disabled");$("#volume-knob").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8","pointer-events":"auto"});$("#volume").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8","pointer-events":"auto"});$("#volumedn").removeClass("hide");$("#volumemute").removeClass("hide");$("#volumeup").removeClass("hide");$("#volumedn").removeClass("disabled");$("#volumemute").removeClass("disabled");$("#volumeup").removeClass("disabled")}$("#stop").removeClass("disabled");$("#play").removeClass("disabled");$("#next").removeClass("disabled")}}else{GUI.activePlayer=""}}function chkKey(e){return e!==undefined&&e!==""}function renderLibraryHome(){loadingSpinner("db");$("#database-entries").addClass("hide");$("#db-level-up").addClass("hide");$("#db-homeSetup").removeClass("hide").removeClass("btn-primary").addClass("btn-default");$("#home-blocks").removeClass("hide");var e=GUI.libraryhome,a=0,s="",t='<div class="col-lg-3 col-md-4 col-sm-6">',i="</div>",o="",n=e.ActivePlayer==="Airplay"||e.ActivePlayer==="SpotifyConnect"||e.ActivePlayer==="Bluetooth";if(isLocalHost){s=""}else{s='<div class="col-sm-12"><h1 class="txtmid">Browse your library</h1></div>'}setPlaybackSource();if(n){o=" inactive"}for(a=0;bookmark=e.bookmarks[a];a+=1){s+=t+'<div id="home-bookmark-'+bookmark.id+'" class="home-block home-bookmark'+o+'" data-path="'+bookmark.path+'"><i class="fa fa-star"></i><h3>'+bookmark.name+"</h3>bookmark</div>"+i}if(chkKey(e.networkMounts)){if(isLocalHost){if(e.networkMounts===0){if(n){s+=t+'<div id="home-nas" class="home-block inactive"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3></div>'+i}else{s+=t+'<a class="home-block'+o+'" href="/sources/add/"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3></a>'+i}}else{s+=t+'<div id="home-nas" class="home-block'+o+'" data-path="NAS"><i class="fa fa-sitemap"></i><h3>Network mounts ('+e.networkMounts+")</h3></div>"+i}}else{if(e.networkMounts===0){if(n){s+=t+'<div id="home-nas" class="home-block inactive"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3>network attached storages</div>'+i}else{s+=t+'<a class="home-block'+o+'" href="/sources/add/"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3>click to add some</a>'+i}}else{s+=t+'<div id="home-nas" class="home-block'+o+'" data-path="NAS"><i class="fa fa-sitemap"></i><h3>Network mounts ('+e.networkMounts+")</h3>network attached storages</div>"+i}}}if(chkKey(e.localStorages)){if(isLocalHost){if(e.localStorages===0){s+=""}else{s+=t+'<div id="home-local" class="home-block'+o+'" data-path="LocalStorage"><i class="fa fa-hdd-o"></i><h3>LocalStorage ('+e.localStorages+")</h3></div>"+i}}else{if(e.localStorages===0){s+=""}else{s+=t+'<div id="home-local" class="home-block'+o+'" data-path="LocalStorage"><i class="fa fa-hdd-o"></i><h3>LocalStorage ('+e.localStorages+")</h3>locally stored music</div>"+i}}}if(chkKey(e.USBMounts)){if(isLocalHost){if(e.USBMounts===0){if(n){s+=t+'<div id="home-usb" class="home-block inactive"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3></div>'+i}else{s+=t+'<a id="home-usb" class="home-block'+o+'" href="/sources"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3></a>'+i}}else{s+=t+'<div id="home-usb" class="home-block'+o+'" data-path="USB"><i class="fa fa-hdd-o"></i><h3>USB storage ('+e.USBMounts+")</h3></div>"+i}}else{if(e.USBMounts===0){if(n){s+=t+'<div id="home-usb" class="home-block inactive"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3>no USB storage plugged</div>'+i}else{s+=t+'<a id="home-usb" class="home-block'+o+'" href="/sources"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3>no USB storage plugged</a>'+i}}else{s+=t+'<div id="home-usb" class="home-block'+o+'" data-path="USB"><i class="fa fa-hdd-o"></i><h3>USB storage ('+e.USBMounts+")</h3>USB attached drives</div>"+i}}}if(chkKey(e.webradio)){if(isLocalHost){if(e.webradio===0){if(n){s+=t+'<div id="home-webradio" class="home-block inactive"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3></div>'+i}else{s+=t+'<a id="home-webradio" class="home-block'+o+'" href="#" data-toggle="modal" data-target="#modal-webradio-add"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3></a>'+i}}else{s+=t+'<div id="home-webradio" class="home-block'+o+'" data-path="Webradio"><i class="fa fa-microphone"></i><h3>My Webradios ('+e.webradio+")</h3></div>"+i}}else{if(e.webradio===0){if(n){s+=t+'<div id="home-webradio" class="home-block inactive"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3>webradio local playlists</div>'+i}else{s+=t+'<a id="home-webradio" class="home-block'+o+'" href="#" data-toggle="modal" data-target="#modal-webradio-add"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3>click to add some</a>'+i}}else{s+=t+'<div id="home-webradio" class="home-block'+o+'" data-path="Webradio"><i class="fa fa-microphone"></i><h3>My Webradios ('+e.webradio+")</h3>webradio local playlists</div>"+i}}}if(isLocalHost){s+=t+'<div id="home-albums" class="home-block'+o+'" data-path="Albums" data-browsemode="album"><i class="fa fa-dot-circle-o"></i><h3>Albums</h3></div>'+i}else{s+=t+'<div id="home-albums" class="home-block'+o+'" data-path="Albums" data-browsemode="album"><i class="fa fa-dot-circle-o"></i><h3>Albums</h3>browse MPD database by album</div>'+i}if(isLocalHost){s+=t+'<div id="home-artists" class="home-block'+o+'" data-path="Artists" data-browsemode="artist"><i class="fa fa-users"></i><h3>Artists</h3></div>'+i}else{s+=t+'<div id="home-artists" class="home-block'+o+'" data-path="Artists" data-browsemode="artist"><i class="fa fa-users"></i><h3>Artists</h3>browse MPD database by artist</div>'+i}if(isLocalHost){s+=t+'<div id="home-composer" class="home-block'+o+'" data-path="Composer" data-browsemode="composer"><i class="fa fa-user-pen"></i><h3>Composer</h3></div>'+i}else{s+=t+'<div id="home-composer" class="home-block'+o+'" data-path="Composer" data-browsemode="composer"><i class="fa fa-user-pen"></i><h3>Composer</h3>browse MPD database by composer</div>'+i}if(isLocalHost){s+=t+'<div id="home-genre" class="home-block'+o+'" data-path="Genres" data-browsemode="genre"><i class="fa fa-tags"></i><h3>Genres</h3></div>'+i}else{s+=t+'<div id="home-genre" class="home-block'+o+'" data-path="Genres" data-browsemode="genre"><i class="fa fa-tags"></i><h3>Genres</h3>browse MPD database by genre</div>'+i}if(chkKey(e.Dirble)){if(isLocalHost){s+=t+'<div id="home-dirble" class="home-block'+o+'" data-plugin="Dirble" data-path="Dirble"><i class="fa fa-globe"></i><h3>Dirble</h3></div>'+i}else{s+=t+'<div id="home-dirble" class="home-block'+o+'" data-plugin="Dirble" data-path="Dirble"><i class="fa fa-globe"></i><h3>Dirble</h3>radio stations open directory</div>'+i}}if(chkKey(e.Jamendo)){if(isLocalHost){s+=t+'<div id="home-jamendo" class="home-block'+o+'" data-plugin="Jamendo" data-path="Jamendo"><i class="fa fa-play-circle-o"></i><h3>Jamendo<span id="home-count-jamendo"></span></h3></div>'+i}else{s+=t+'<div id="home-jamendo" class="home-block'+o+'" data-plugin="Jamendo" data-path="Jamendo"><i class="fa fa-play-circle-o"></i><h3>Jamendo<span id="home-count-jamendo"></span></h3>world\'s largest platform for free music</div>'+i}}if(chkKey(e.HWinput)){if(chkKey(GUI.libraryhome.HWinput.status)){GUI.libraryhome.HWinput.HWdevices=Object.keys(GUI.libraryhome.HWinput.status).length}else{GUI.libraryhome.HWinput.HWdevices=0}if(isLocalHost){s+=t+'<div id="home-hwinput" class="home-block'+o+'" data-plugin="HWinput" data-path="HWinput"><i class="fa fa-wave-square"></i><h3>HW Input ('+GUI.libraryhome.HWinput.HWdevices+")</h3></div>"+i}else{s+=t+'<div id="home-hwinput" class="home-block'+o+'" data-plugin="HWinput" data-path="HWinput"><i class="fa fa-wave-square"></i><h3>HW Input ('+GUI.libraryhome.HWinput.HWdevices+")</h3>browse locally connected hardware input devices</div>"+i}}if(chkKey(e.CDinput)){if(typeof GUI.libraryhome.CDinput.status!=="undefined"){GUI.libraryhome.CDinput.CDtracks=Object.keys(GUI.libraryhome.CDinput.status).length}else{GUI.libraryhome.CDinput.CDtracks=0}if(GUI.libraryhome.CDinput.CDtracks>0){GUI.libraryhome.CDinput.CDtracks--;$("#eject").removeClass("hide");$("#eject").removeClass("disabled")}else{$("#eject").addClass("hide")}if(isLocalHost){s+=t+'<div id="home-cdinput" class="home-block'+o+'" data-plugin="CDinput" data-path="CDinput"><i class="fa fa-compact-disc"></i><h3>CD-Drive ('+GUI.libraryhome.CDinput.CDtracks+")</h3></div>"+i}else{s+=t+'<div id="home-cdinput" class="home-block'+o+'" data-plugin="CDinput" data-path="CDinput"><i class="fa fa-compact-disc"></i><h3>CD-Drive ('+GUI.libraryhome.CDinput.CDtracks+")</h3>browse locally connected CD-drive</div>"+i}}s+="</div>";document.getElementById("home-blocks").innerHTML=s;loadingSpinner("db","hide");$("span","#db-currentpath").html("")}function refreshState(){if(GUI.json.state!==undefined){if(GUI.json.updating_db!==undefined){GUI.DBupdate=true}else{GUI.DBupdate=false}}if(GUI.DBupdate){$("a","#open-panel-sx").html('<i class="fa fa-refresh fa-spin"></i> Updating')}else{$("a","#open-panel-sx").html('<i class="fa fa-music sx"></i> Library')}var e=GUI.state;if(e==="play"){$("#play").addClass("btn-primary");$("i","#play").removeClass("fa fa-pause").addClass("fa fa-play");$("#stop").removeClass("btn-primary")}else if(e==="pause"){$("#playlist-position span").html("Not playing");$("#playlist-position-ss span").html("Not playing");$("#playlist-position-sss span").html("Not playing");$("#play").addClass("btn-primary");$("i","#play").removeClass("fa fa-play").addClass("fa fa-pause");$("#stop").removeClass("btn-primary")}else if(e==="stop"){$("#play").removeClass("btn-primary");$("i","#play").removeClass("fa fa-pause").addClass("fa fa-play");$("#stop").addClass("btn-primary");if($("#section-index").length){$("#countdown-display").countdown("destroy");$("#countdown-display-ss").countdown("destroy");$("#countdown-display-sss").countdown("destroy")}refreshTimer(0,0,"stop");window.clearInterval(GUI.currentKnob);if(GUI.stream){$("#total").html("<span>&infin;</span>");$("#total-ss").html("<span>&infin;</span>");$("#total-sss").html("<span>&infin;</span>")}else{$("#total").html("00:00");$("#total-ss").html("00:00");$("#total-sss").html("00:00")}$("#time").val(0,false).trigger("update");$("#format-bitrate").html("&nbsp;");$("#format-bitrate-ss").html("&nbsp;");$("#format-bitrate-sss").html("&nbsp;");$("li","#playlist-entries").removeClass("active")}if(e!=="stop"){if(GUI.stream){$("#total").html("<span>&infin;</span>");$("#total-ss").html("<span>&infin;</span>");$("#total-sss").html("<span>&infin;</span>")}else{$("#total").html(GUI.json.time!==undefined?timeConvert(GUI.json.time):"00:00");$("#total-ss").html(GUI.json.time!==undefined?timeConvert(GUI.json.time):"00:00");$("#total-sss").html(GUI.json.time!==undefined?timeConvert(GUI.json.time):"00:00")}var a=GUI.json.audio_channels&&GUI.json.audio_sample_depth&&GUI.json.audio_sample_rate?GUI.json.audio_channels+", "+GUI.json.audio_sample_depth+"-bit, "+GUI.json.audio_sample_rate+" kHz, "+GUI.json.bitrate+" kbit/s":"&nbsp;";$("#format-bitrate").html(a);$("#format-bitrate-ss").html(a);$("#format-bitrate-sss").html(a);$("li","#playlist-entries").removeClass("active");var s=parseInt(GUI.json.song);$("#playlist-entries").find("li").eq(s).addClass("active")}if(GUI.json.playlistlength&&GUI.json.playlistlength!=="0"){if(GUI.activePlayer!==undefined&&GUI.activePlayer!="MPD"){$("#playlist-position span").html("Streaming");$("#playlist-position-ss span").html("Streaming");$("#playlist-position-sss span").html("Streaming")}else if(GUI.json.song){$("#playlist-position span").html("Queue position "+(parseInt(GUI.json.song)+1)+"/"+GUI.json.playlistlength);$("#playlist-position-ss span").html("Queue position "+(parseInt(GUI.json.song)+1)+"/"+GUI.json.playlistlength);$("#playlist-position-sss span").html("Queue position "+(parseInt(GUI.json.song)+1)+"/"+GUI.json.playlistlength)}else{$("#playlist-position span").html("Queue position 1/"+GUI.json.playlistlength);$("#playlist-position-ss span").html("Queue position 1/"+GUI.json.playlistlength);$("#playlist-position-sss span").html("Queue position 1/"+GUI.json.playlistlength)}}else{$("#playlist-position span").html("Empty queue, add some music!");$("#playlist-position-ss span").html("Empty queue, add some music!");$("#playlist-position-sss span").html("Empty queue, add some music!")}}function updateGUI(){var e=typeof GUI.json.volume=="undefined"?0:GUI.json.volume;var a=typeof GUI.json.radioname=="undefined"?"":GUI.json.radioname;var s=typeof GUI.json.currentartist=="undefined"?"":GUI.json.currentartist;var t=typeof GUI.json.currentsong=="undefined"?"":GUI.json.currentsong;var i=typeof GUI.json.currentalbum=="undefined"?"":GUI.json.currentalbum;var o=typeof GUI.json.currentalbumartist=="undefined"?"":GUI.json.currentalbumartist;var n=typeof GUI.json.currentcomposer=="undefined"?"":GUI.json.currentcomposer;var l=typeof GUI.json.mainArtURL=="undefined"?"":GUI.json.mainArtURL;var r=typeof GUI.json.smallArtURL=="undefined"?"":GUI.json.smallArtURL;var d=typeof GUI.json.bigArtURL=="undefined"?"":GUI.json.bigArtURL;var c=typeof GUI.json.coverArtPreload=="undefined"?"":GUI.json.coverArtPreload;var p=typeof GUI.json.song_lyrics=="undefined"?"":GUI.json.song_lyrics;var u=typeof GUI.json.artist_bio_summary=="undefined"?"":GUI.json.artist_bio_summary;var m=typeof GUI.json.artist_similar=="undefined"?"":GUI.json.artist_similar;var f=typeof GUI.json.actPlayer=="undefined"?"":GUI.json.actPlayer;var h=typeof GUI.json.file=="undefined"?"":GUI.json.file;if(a!==null&&a!==undefined&&a!==""){GUI.stream="radio"}else if(h!==null&&h.substring(0,7)==="alsa://"){GUI.stream="HWinput"}else if(f!==undefined&&f==="Bluetooth"){GUI.stream="bluetooth"}else{GUI.stream=""}if(typeof GUI.json.consume!=="undefined"){GUI.consume=GUI.json.consume}if(f!==GUI.activePlayer||e!==GUI.volume){GUI.activePlayer=f;setPlaybackSource()}if(typeof GUI.json.song_percent==="undefined"&&typeof GUI.json.elapsed!=="undefined"&&typeof time!=="undefined"){if(GUI.json.elapsed!=="0"&&time!=="0"){GUI.json.song_percent=parseInt(parseInt(GUI.json.elapsed)*100/parseInt(time))}else{GUI.json.song_percent="0"}}refreshState();if($("#section-index").length){if(l!==""&&GUI.mainArtURL===l&&!$("#cover-art").css("background-image").includes(l)){GUI.currentartist="";GUI.currentsong="";GUI.currentalbum="";GUI.song_lyrics="";GUI.mainArtURL="";GUI.smallArtURL="";GUI.bigArtURL="";GUI.coverArtPreload="";GUI.artist_bio_summary="";GUI.artist_similar="";GUI.file=""}if(GUI.file!==h){GUI.file=h;countdownRestart(GUI.json.elapsed);if($("#panel-dx").hasClass("active")){var b=parseInt(GUI.json.song);customScroll("pl",b)}}if(GUI.vol_changed_local===0){$("#volume").val(e==="-1"?100:e,false).trigger("update")}if(s===""||s===null){var s='<span class="notag">[no artist]</span>'}if(GUI.currentartist!==s){GUI.currentartist=s;if(GUI.currentartist.length>55){$("#currentartist-ss")[0].style.fontSize="18px";$("#currentartist-sss")[0].style.fontSize="28px"}else if(GUI.currentartist.length>45){$("#currentartist-ss")[0].style.fontSize="20px";$("#currentartist-sss")[0].style.fontSize="30px"}else if(GUI.currentartist.length>30){$("#currentartist-ss")[0].style.fontSize="22px";$("#currentartist-sss")[0].style.fontSize="32px"}else{$("#currentartist-ss")[0].style.fontSize="28px";$("#currentartist-sss")[0].style.fontSize="34px"}$("#currentartist").html(GUI.currentartist);$("#currentartist-ss").html(GUI.currentartist);$("#currentartist-sss").html(GUI.currentartist)}if(t===""||GUI.currentsong===null){var t='<span class="notag">[no song]</span>'}if(GUI.currentsong!==t){GUI.currentsong=t;if(GUI.currentsong.length>55){$("#currentsong-ss")[0].style.fontSize="18px";$("#currentsong-sss")[0].style.fontSize="28px"}else if(GUI.currentsong.length>45){$("#currentsong-ss")[0].style.fontSize="20px";$("#currentsong-sss")[0].style.fontSize="30px"}else if(GUI.currentsong.length>35){$("#currentsong-ss")[0].style.fontSize="26px";$("#currentsong-sss")[0].style.fontSize="32px"}else if(GUI.currentsong.length>25){$("#currentsong-ss")[0].style.fontSize="32px";$("#currentsong-sss")[0].style.fontSize="36px"}else{$("#currentsong-ss")[0].style.fontSize="40px";$("#currentsong-sss")[0].style.fontSize="40px"}$("#currentsong").html(GUI.currentsong);$("#currentsong-ss").html(GUI.currentsong);$("#currentsong-sss").html(GUI.currentsong)}if(i===""||i===null){var i='<span class="notag">[no album]</span>'}if(GUI.currentalbum!==i){GUI.currentalbum=i;if(GUI.currentalbum.length>55){$("#currentalbum-ss")[0].style.fontSize="18px";$("#currentalbum-sss")[0].style.fontSize="28px"}else if(GUI.currentalbum.length>45){$("#currentalbum-ss")[0].style.fontSize="20px";$("#currentalbum-sss")[0].style.fontSize="30px"}else if(GUI.currentalbum.length>30){$("#currentalbum-ss")[0].style.fontSize="22px";$("#currentalbum-sss")[0].style.fontSize="32px"}else{$("#currentalbum-ss")[0].style.fontSize="24px";$("#currentalbum-sss")[0].style.fontSize="34px"}$("#currentalbum").html(GUI.currentalbum);$("#currentalbum-ss").html(GUI.currentalbum);$("#currentalbum-sss").html(GUI.currentalbum)}if(GUI.json.repeat==="1"){$("#repeat").addClass("btn-primary")}else{$("#repeat").removeClass("btn-primary")}if(GUI.json.random==="1"){$("#random").addClass("btn-primary")}else{$("#random").removeClass("btn-primary")}if(GUI.consume==="1"){$("#consume").addClass("btn-primary")}else{$("#consume").removeClass("btn-primary")}if(GUI.json.single==="1"){$("#single").addClass("btn-primary")}else{$("#single").removeClass("btn-primary")}if(p!==""&&GUI.song_lyrics!==p){GUI.song_lyrics=p;$("#lyric-text-overlay").html(p)}if(l!==""&&GUI.mainArtURL!==l){GUI.mainArtURL=l;$("#cover-art").css("background-image","url("+l+")");$("#cover-art-sss").css("background-image","url("+l+")")}if(r!==""&&GUI.smallArtURL!==r){GUI.smallArtURL=r;$("#artist-image-ss").css("background-image",'url("'+r+'")');$("#artist-image-overlay").css("background-image",'url("'+r+'")')}if(d!==""&&GUI.bigArtURL!==d){GUI.bigArtURL=d;$("#cover-art-ss").css("background-image",'url("'+d+'")')}if(c!==""&&GUI.coverArtPreload!==c){GUI.coverArtPreload=c;$("#cover-art-preload").css("background-image",'url("'+c+'")')}if(u!==""&&GUI.artist_bio_summary!==u){GUI.artist_bio_summary=u;$("#artist-bio-ss").html(u);$("#artist-bio-overlay").html(u)}if(m!==""&&GUI.artist_similar!==m){GUI.artist_similar=m;$("#addinfo-text-ss").html(m);$("#addinfo-text-overlay").html(m)}}}function getPlaylistPlain(e){var a=parseInt(GUI.json.song)+1;var s=GUI.state;var t="",i="",o="",n="",l="",r="",d="",c="",p="",u=0,m="",f="",h=0,b=0,v=0;var y,g,I=e.split("\n"),C=[];for(y=0;g=I[y];y+=1){C=g.split(/: (.+)?/);if("Time"===C[0]){i=parseInt(C[1])}else if("Artist"===C[0]){o=C[1]}else if("Title"===C[0]){l=C[1]}else if("Name"===C[0]){r=C[1]}else if("Album"===C[0]){n=C[1]}else if("file"===C[0]){d=C[1]}else if("Id"===C[0]){m=C[1];if(l===""){c=d.split("/").pop();if(d.substring(0,7)==="cdda://"){l='<i class="fa fa-compact-disc"></i> CD Track #'+c;if(typeof GUI.libraryhome.CDinput.status[c]!="undefined"&&GUI.libraryhome.CDinput.status[c].time){i=GUI.libraryhome.CDinput.status[c].time}}else if(d.substring(0,7)==="alsa://"){if(typeof GUI.libraryhome.HWinput.status[d]!=="undefined"&&GUI.libraryhome.HWinput.status[d].name){l='<i class="fa fa-wave-square"></i> Hardware input: '+GUI.libraryhome.HWinput.status[d].name+" - "+GUI.libraryhome.HWinput.status[d].sysname;o=GUI.libraryhome.HWinput.status[d].description;n=d}else{l='<i class="fa fa-wave-square"></i> Hardware input: '+d}}else{l=c}}if(d.substring(0,4).toLowerCase()==="http"&&o===""&&n===""&&r===""){r=l}if(o===""||n===""){p=parsePath(d);if(o===""){f="path: "+p}else{f=o}}else{f=o+" - "+n}if(r!==""){if(r!==l&&l!==""){l='<i class="fa fa-microphone"></i>'+r+" : "+l}else{l='<i class="fa fa-microphone"></i>'+r}f="URL: "+d;h=""}else if(typeof i==="undefined"||!i){h=""}else{h="<span>"+timeConvert2(i)+"</span>";b+=i}v++;t+='<li id="pl-'+m+'"'+(s!=="stop"&&v===a?' class="active"':"")+'><i class="fa fa-times-circle pl-action" title="Remove song from playlist"></i><span class="sn">'+l+h+'</span><span class="bl">'+f+"</span></li>";i="";o="";n="";l="";r=""}}$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");var U=document.getElementById("playlist-entries");if(U){U.innerHTML=t}$("#pl-filter-results").addClass("hide").html("");$("#pl-filter").val("");$("#pl-manage").removeClass("hide");$("#pl-count").removeClass("hide").html(v+(v!==1?" entries":" entry")+" "+timeConvert3(b)+" total playtime")}function getPlaylistCmd(){loadingSpinner("pl");$.ajax({url:"/db/?cmd=playlist",success:function(e){if(e.length>4){$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");getPlaylistPlain(e);var a=parseInt(GUI.json.song);if($("#panel-dx").hasClass("active")&&GUI.currentsong!==GUI.json.currentsong){customScroll("pl",a,200)}}else{$(".playlist").addClass("hide");$("#playlist-warning").removeClass("hide");$("#pl-filter-results").addClass("hide").html("");$("#pl-count").removeClass("hide").html("0 entries")}loadingSpinner("pl","hide")},cache:false})}function getPlaylist(e){data=e[0];if(data.length>4){$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");getPlaylistPlain(data);var a=parseInt(GUI.json.song);if($("#panel-dx").hasClass("active")&&GUI.currentsong!==GUI.json.currentsong){customScroll("pl",a,200)}}else{$(".playlist").addClass("hide");$("#playlist-warning").removeClass("hide");$("#pl-filter-results").addClass("hide").html("");$("#pl-count").removeClass("hide").html("0 entries")}loadingSpinner("pl","hide")}function renderUI(e){toggleLoader("close");GUI.json=e[0];if(typeof GUI.json.state!=="undefined"){if(GUI.state!==GUI.json.state){GUI.state=GUI.json.state;if(typeof GUI.json.actPlayer!=="undefined"){setUIbuttons(GUI.json.actPlayer)}}}if(typeof GUI.json.time!=="undefined"){var a=GUI.json.time}if(typeof GUI.json.elapsed!=="undefined"&&GUI.state!=="stop"){refreshTimer(parseInt(GUI.json.elapsed),0,GUI.state)}updateGUI();if($("#section-index").length){if(GUI.state!=="stop"&&GUI.json.elapsed!=="undefined"&&typeof GUI.json.song_percent!=="undefined"){refreshKnob()}if(GUI.json.playlist!==GUI.playlist){getPlaylistCmd();GUI.playlist=GUI.json.playlist}}checkPlayerState()}function renderPlaylists(e){var a="",s="",t=false;var i,o,n=e.split("\n"),l=[];n.sort(function(e,a){return e.toLowerCase().localeCompare(a.toLowerCase())});for(i=0;i<n.length;i++){l=n[i].split(": ");if("playlist"===l[0]){s=l[1];a+='<li class="pl-folder" data-path="'+s+'"><i class="fa fa-bars pl-action" data-target="#context-menu-playlist" data-toggle="context" title="Actions"></i><span><i class="fa fa-list-ol"></i>'+s+"</span></li>";s="";t=true}}document.getElementById("playlist-entries").innerHTML="";$(".playlist").addClass("hide");$("#pl-manage").addClass("hide");$("#pl-count").addClass("hide");if(t){$("#pl-filter-results").removeClass("hide").addClass("back-to-queue").html('<i class="fa fa-arrow-left sx"></i> Back to queue')}else{$("#pl-filter-results").removeClass("hide").addClass("back-to-queue").html('<i class="fa fa-arrow-left sx"></i> No playlists found, return to queue')}$("#pl-currentpath").removeClass("hide");$("#pl-editor").removeClass("hide");document.getElementById("pl-editor").innerHTML=a;loadingSpinner("pl","hide")}function getPlaylists(){loadingSpinner("pl");$.ajax({url:"/command/?cmd=listplaylists",success:function(e){renderPlaylists(e)},cache:false})}function updatePlaylistDropdown(e){var a,s,t=e.split("\n"),i=[];var o="";for(a=0;s=t[a];a+=1){i=s.split(": ");if("playlist"===i[0]){o+='<option value="'+i[1]+'" />'}}document.getElementById("pl-list").innerHTML=o;loadingSpinner("pl","hide")}function getPlaylistsDropdown(){loadingSpinner("pl");$.ajax({url:"/command/?cmd=listplaylists",success:function(e){updatePlaylistDropdown(e)},cache:false})}function parseResponse(e){var a=e.inputArr||"",s=e.respType||"",t=e.i||0,i=e.inpath||"",o=e.querytype||"",n="";switch(s){case"playlist":break;case"db":if(GUI.browsemode==="file"){if(i===""&&a.file!==undefined){i=parsePath(a.file)}if(a.file!==undefined||i==="Webradio"){n='<li id="db-'+(t+1)+'" data-path="';if(a.fileext===undefined){if(a.file!==undefined){a.fileext=a.file.split(".").pop().toLowerCase()}else{a.fileext=""}}else{a.fileext=a.fileext.toLowerCase()}if(a.Title!==undefined){n+=a.file;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';n+=a.Title+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";n+=' <span class="bl">';n+=a.Artist;n+=" - ";n+=a.Album}else{if(i!=="Webradio"){n+=a.file;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';n+=a.file.replace(i+"/","")+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";n+='<span class="bl">';n+=" path: ";n+=i}else{n+=a.playlist;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-webradio"></i><i class="fa fa-microphone db-icon db-radio"></i>';n+='<span class="sn">'+a.playlist.replace(i+"/","").replace("."+a.fileext,"");n+='</span><span class="bl">webradio'}}n+="</span></li>"}else if(a.playlist!==undefined){if(a.fileext==="cue"){n='<li id="db-'+(t+1)+'" data-path="';n+=a.playlist;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-file-text db-icon"></i><span class="sn">';n+=a.playlist.replace(i+"/","")+" <span>[CUE file]</span></span>";n+='<span class="bl">';n+=" path: ";n+=i;n+="</span></li>"}}else{n='<li id="db-'+(t+1)+'" class="db-folder" data-path="';n+=a.directory;if(i!==""){n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu"></i><span><i class="fa fa-folder-open"></i>'}else{n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-root"></i><i class="fa fa-hdd-o icon-root"></i><span>'}n+=a.directory.replace(i+"/","");n+="</span></li>"}}else if(GUI.browsemode==="album"||GUI.browsemode==="albumfilter"){if(a.file!==undefined){n='<li id="db-'+(t+1)+'" data-path="';n+=a.file;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';n+=a.Title+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";n+=' <span class="bl">';n+=a.Artist;n+=" - ";n+=a.Album;n+="</span></li>"}else if(a.album!==""){n='<li id="db-'+(t+1)+'" class="db-folder db-album" data-path="';n+=a.album.replace(/\"/g,"&quot;");n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-album"></i><span><i class="fa fa-dot-circle-o"></i>';n+=a.album;n+="</span></li>"}}else if(GUI.browsemode==="artist"){if(a.album!==undefined){n='<li id="db-'+(t+1)+'" class="db-folder db-album" data-path="';n+=a.album;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-album"></i><span><i class="fa fa-dot-circle-o"></i>';n+=a.album!==""?a.album:"Unknown album";n+="</span></li>"}else if(a.artist!==""){n='<li id="db-'+(t+1)+'" class="db-folder db-artist" data-path="';n+=a.artist;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-artist"></i><span><i class="fa fa-user"></i>';n+=a.artist;n+="</span></li>"}}else if(GUI.browsemode==="composer"){if(a.file!==undefined){n='<li id="db-'+(t+1)+'" data-path="';n+=a.file;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';n+=a.Title+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";n+=' <span class="bl">';n+=a.Artist;n+=" - ";n+=a.Album;n+="</span></li>"}else if(a.composer!==""){n='<li id="db-'+(t+1)+'" class="db-folder db-composer" data-path="';n+=a.composer;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-composer"></i><span><i class="fa fa-user"></i>';n+=a.composer;n+="</span></li>"}}else if(GUI.browsemode==="genre"){if(a.artist!==undefined){n='<li id="db-'+(t+1)+'" class="db-folder db-artist" data-path="';n+=a.artist;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-artist"></i><span><i class="fa fa-dot-circle-o"></i>';n+=a.artist!==""?a.artist:"Unknown artist";n+="</span></li>"}else if(a.genre!==""){n='<li id="db-'+(t+1)+'" class="db-folder db-genre" data-path="';n+=a.genre;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-genre"></i><span><i class="fa fa-tags"></i>';n+=a.genre;n+="</span></li>"}}break;case"CDinput":n='<li id="db-'+(t+1)+'" data-path="';n+=a.file;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-hw"></i><i class="fa fa-compact-disc db-icon"></i><span class="sn">';n+=a.name+" <span>"+timeConvert(a.time)+"</span>";n+='<span class="bl">';n+=a.file;n+="</span></li>";break;case"HWinput":n='<li id="db-'+(t+1)+'" data-path="';n+=a.file;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-hw"></i><i class="fa fa-wave-square db-icon"></i><span class="sn">';n+=a.name+" <span>"+a.sysname+a.note+"</span>";n+='<span class="bl">';n+=a.file+" - "+a.description;n+="</span></li>";break;case"Dirble":if(o===""||o==="childs"){var l=o==="childs"?" db-dirble-child":"";n='<li id="db-'+(t+1)+'" class="db-dirble db-folder'+l+'" data-path="';n+=a.id;n+='"><span><i class="fa fa-folder-open"></i>';n+=a.title;n+="</span></li>"}else if(o==="search"||o==="stations"||o==="childs-stations"){if(a.streams.length===0){break}n='<li id="db-'+(t+1)+'" class="db-dirble db-radio" data-path="';n+=a.name+" | "+a.streams[0].stream;n+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-dirble"></i><i class="fa fa-microphone db-icon"></i>';n+='<span class="sn">'+a.name+"<span>("+a.country+")</span></span>";n+='<span class="bl">';n+=a.website?a.website:"-no website-";n+="</span></li>"}break;case"Jamendo":n='<li id="db-'+(t+1)+'" class="db-jamendo db-folder" data-path="';n+=a.stream;n+='"><img class="jamendo-cover" src="/tun/'+a.image+'" alt=""><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i>';n+=a.dispname+"</div></li>";break}return n}function populateDB(e){var a=e.data||"",s=e.path||"",t=e.uplevel||0,i=e.keyword||"",o=e.plugin||"",n=e.querytype||"",l=e.args||"",r="",d=0,c=[];if(o!==""){if(o==="CDinput"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").addClass("hide");if(s){if(n==="search"){GUI.currentpath="CDinput"}else{GUI.currentpath=s}}r="<legend>&nbsp;CD Input";if(typeof GUI.libraryhome.CDinput.model!="undefined"&&GUI.libraryhome.CDinput.model){r+=" - "+GUI.libraryhome.CDinput.model+" ("+GUI.libraryhome.CDinput.device+")"}if(typeof GUI.libraryhome.CDinput.error!="undefined"&&GUI.libraryhome.CDinput.error){r+="<br><i>&nbsp;"+GUI.libraryhome.CDinput.error+"</i>"}r+="</legend>";if(typeof GUI.libraryhome.CDinput.status!=="undefined"&&Object.keys(GUI.libraryhome.CDinput.status).length){for(d=0;c=GUI.libraryhome.CDinput.status[d];d+=1){r+=parseResponse({inputArr:c,respType:"CDinput",i:d,querytype:n})}}document.getElementById("database-entries").innerHTML=r}if(o==="HWinput"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").addClass("hide");if(s){if(n==="search"){GUI.currentpath="HWinput"}else{GUI.currentpath=s}}r="<legend>&nbsp;Hardware Input";if(typeof GUI.libraryhome.HWinput.format!="undefined"&&GUI.libraryhome.HWinput.format){r+="<br>&nbsp;Predefined format: "+GUI.libraryhome.HWinput.format}if(typeof GUI.libraryhome.HWinput.error!="undefined"&&GUI.libraryhome.HWinput.error){r+="<br><i>&nbsp;"+GUI.libraryhome.HWinput.error+"</i>"}r+="</legend>";if(typeof GUI.libraryhome.HWinput.status!="undefined"&&Object.keys(GUI.libraryhome.HWinput.status).length){for(var p in GUI.libraryhome.HWinput.status){c=GUI.libraryhome.HWinput.status[p];r+=parseResponse({inputArr:c,respType:"HWinput",i:d,querytype:n})}}document.getElementById("database-entries").innerHTML=r}if(o==="Dirble"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").removeClass("hide");if(s){if(n==="search"){GUI.currentpath="Dirble"}else{GUI.currentpath=s}}if(n==="childs-stations"){r=document.getElementById("database-entries").innerHTML}else{document.getElementById("database-entries").innerHTML=""}a.sort(function(e,a){if(n===""||n==="childs"||n==="categories"){nameA=e.hasOwnProperty("title")?e.title.toLowerCase():"";nameB=a.hasOwnProperty("title")?a.title.toLowerCase():""}else if(n==="childs-stations"||n==="stations"){nameA=e.hasOwnProperty("name")?e.name.toLowerCase():"";nameB=a.hasOwnProperty("name")?a.name.toLowerCase():""}else{return 0}return nameA.localeCompare(nameB)});for(d=0;c=a[d];d+=1){r+=parseResponse({inputArr:c,respType:"Dirble",i:d,querytype:n})}document.getElementById("database-entries").innerHTML=r}if(o==="Jamendo"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").removeClass("hide");if(s){GUI.currentpath=s}document.getElementById("database-entries").innerHTML="";a.sort(function(e,a){if(s==="Jamendo"&&n===""){nameA=e.hasOwnProperty("dispname")?e.dispname.toLowerCase():"";nameB=a.hasOwnProperty("dispname")?a.dispname.toLowerCase():""}else{return 0}return nameA.localeCompare(nameB)});for(d=0;c=a[d];d+=1){r+=parseResponse({inputArr:c,respType:"Jamendo",i:d,querytype:n})}document.getElementById("database-entries").innerHTML=r}}else{if(s===""&&i===""){renderLibraryHome();return}else{$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").removeClass("hide");if(s){GUI.currentpath=s}document.getElementById("database-entries").innerHTML="";if(i!==""){var u=a.length?a.length:"0";var m=a.length===1?"":"s";$("#db-level-up").addClass("hide");$("#db-search-results").removeClass("hide").html('<i class="fa fa-times sx"></i><span class="visible-xs-inline">back</span><span class="hidden-xs">'+u+" result"+m+' for "<span class="keyword">'+i+'</span>"</span>')}a.sort(function(e,a){if(s==="Artists"||s==="AlbumArtists"||s==="Various Artists"){nameA=e.hasOwnProperty("artist")?e.artist.toLowerCase():"";nameB=a.hasOwnProperty("artist")?a.artist.toLowerCase():""}else if(s==="Albums"){nameA=e.hasOwnProperty("album")?e.album.toLowerCase():"";nameB=a.hasOwnProperty("album")?a.album.toLowerCase():""}else if(s==="Webradio"){nameA=e.hasOwnProperty("playlist")?e.playlist.toLowerCase():"";nameB=a.hasOwnProperty("playlist")?a.playlist.toLowerCase():""}else if(s==="Genres"){nameA=e.hasOwnProperty("genre")?e.genre.toLowerCase():"";nameB=a.hasOwnProperty("genre")?a.genre.toLowerCase():""}else if(s){nameA=e.hasOwnProperty("directory")?e.directory.toLowerCase():"";nameB=a.hasOwnProperty("directory")?a.directory.toLowerCase():""}else{return 0}return nameA.localeCompare(nameB)});if(s==="Webradio"){r+='<li id="webradio-add" class="db-webradio-add"><i class="fa fa-plus-circle db-icon"></i><span class="sn"><em>add new</em></span><span class="bl">add a webradio to your library</span></li>'}for(d=0;c=a[d];d+=1){r+=parseResponse({inputArr:c,respType:"db",i:d,inpath:s})}document.getElementById("database-entries").innerHTML=r}}var f=$("span","#db-currentpath");if(GUI.browsemode==="album"){if(s==="Albums"){f.html(s)}else{f.html("Albums/"+s)}}else if(GUI.browsemode==="artist"){if(s==="Artists"){f.html(s)}else{f.html("Artists/"+s)}}else if(GUI.browsemode==="composer"){if(s==="Composer"){f.html(s)}else{f.html("Composer/"+s)}}else if(GUI.browsemode==="genre"){if(s==="Genres"){f.html(s)}else{f.html("Genres/"+s)}}else{f.html(s)}$("#db-homeSetup").addClass("hide");if(t){var h=GUI.currentDBpos[GUI.currentDBpos[10]];$("#db-"+h).addClass("active");customScroll("db",h,0)}else{customScroll("db",0,0)}if(n!="childs"){loadingSpinner("db","hide")}}function getDB(e){var a=e.cmd||"browse",s=e.path||"",t=e.browsemode||"file",i=e.uplevel||"",o=e.plugin||"",n=e.querytype||"",l=e.args||"";loadingSpinner("db");GUI.browsemode=t;if(o!==""){if(o==="Dirble"){if(n==="childs"){$.post("/db/?cmd=dirble",{querytype:"childs",args:l},function(e){populateDB({data:e,path:s,plugin:o,querytype:"childs",uplevel:i})},"json");$.post("/db/?cmd=dirble",{querytype:"childs-stations",args:l},function(e){populateDB({data:e,path:s,plugin:o,querytype:"childs-stations",uplevel:i})},"json")}else{$.post("/db/?cmd=dirble",{querytype:n===""?"categories":n,args:l},function(e){populateDB({data:e,path:s,plugin:o,querytype:n,uplevel:i})},"json")}}else if(o==="CDinput"){populateDB({data:0,path:s,plugin:o,querytype:n})}else if(o==="HWinput"){populateDB({data:0,path:s,plugin:o,querytype:n})}else if(o==="Jamendo"){$.post("/db/?cmd=jamendo",{querytype:n===""?"radio":n,args:l},function(e){populateDB({data:e.results,path:s,plugin:o,querytype:n})},"json")}}else{if(a==="search"){var r=$("#db-search-keyword").val();if(s.match(/Dirble/)){$.post("/db/?cmd=dirble",{querytype:"search",args:r},function(e){populateDB({data:e,path:s,plugin:"Dirble",querytype:"search",uplevel:i})},"json")}else{$.post("/db/?querytype="+GUI.browsemode+"&cmd=search",{query:r},function(e){populateDB({data:e,path:s,uplevel:i,keyword:r})},"json")}}else if(a==="browse"){$.post("/db/?cmd=browse",{path:s,browsemode:GUI.browsemode},function(e){populateDB({data:e,path:s,uplevel:i})},"json")}else{loadingSpinner("db","hide");$.post("/db/?cmd="+a,{path:s,querytype:n},function(e){},"json")}}}function onreleaseKnob(e){if(GUI.state!=="stop"&&GUI.state!==""){if(!GUI.stream){window.clearInterval(GUI.currentKnob);var a=Math.floor(e*parseInt(GUI.json.time)/1e3);sendCmd("seek "+GUI.json.song+" "+a);$("#time").val(e);$("#countdown-display").countdown("destroy");$("#countdown-display-ss").countdown("destroy");$("#countdown-display-sss").countdown("destroy");$("#countdown-display").countdown({since:-a,compact:true,format:"MS"});$("#countdown-display-ss").countdown({since:-a,compact:true,format:"MS"});$("#countdown-display-sss").countdown({since:-a,compact:true,format:"MS"})}}}function commandButton(e){var a=e.data("cmd");var s;if(a==="stop"){e.addClass("btn-primary");$("#play").removeClass("btn-primary");if($("#section-index").length){refreshTimer(0,0,"stop");window.clearInterval(GUI.currentKnob);$(".playlist").find("li").removeClass("active");$("#total").html("00:00");$("#total-ss").html("00:00");$("#total-sss").html("00:00")}}else if(a==="play"){var t=GUI.state;if(t==="play"){s="pause";if($("#section-index").length){$("#countdown-display").countdown("pause");$("#countdown-display-ss").countdown("pause");$("#countdown-display-sss").countdown("pause")}}else if(t==="pause"){s="play";if($("#section-index").length){$("#countdown-display").countdown("resume");$("#countdown-display-ss").countdown("resume");$("#countdown-display-sss").countdown("resume")}}else if(t==="stop"){s="play";if($("#section-index").length){$("#countdown-display").countdown({since:0,compact:true,format:"MS"});$("#countdown-display-ss").countdown({since:0,compact:true,format:"MS"});$("#countdown-display-sss").countdown({since:0,compact:true,format:"MS"})}}window.clearInterval(GUI.currentKnob);sendCmd(s);return}else if(a==="previous"||a==="next"){if($("#section-index").length){$("#countdown-display").countdown("pause");$("#countdown-display-ss").countdown("pause");$("#countdown-display-sss").countdown("pause");window.clearInterval(GUI.currentKnob)}}else if(e.hasClass("btn-volume")){var i;var o=parseInt($("#volume").val());if(typeof GUI.volume!=="number"){GUI.volume=o}GUI.volume=parseInt(GUI.volume);if(a==="volumedn"){i=Math.max(GUI.volume-1,0);GUI.volume=i;$("#volumemute").removeClass("btn-primary")}else if(a==="volumeup"){i=Math.min(GUI.volume+1,100);GUI.volume=i;$("#volumemute").removeClass("btn-primary")}else if(a==="volumemute"){if(o!==0){GUI.volume=o;e.addClass("btn-primary");i=0}else{e.removeClass("btn-primary");i=GUI.volume}}if(i>=0&&i<=100){sendCmd("setvol "+i);$("#volume").val(i,false).trigger("update")}return}if(e.hasClass("btn-toggle")){s=a+(e.hasClass("btn-primary")?" 0":" 1");e.toggleClass("btn-primary")}else{s=a}sendCmd(s)}function libraryHome(e){GUI.libraryhome=e[0];if(GUI.libraryhome.clientUUID===GUI.clientUUID&&GUI.plugin!=="Dirble"&&GUI.currentpath!=="Webradio"){renderLibraryHome()}if(GUI.currentpath==="Webradio"){getDB({path:"Webradio",uplevel:0})}if(GUI.forceGUIupdate===true){GUI.forceGUIupdate=false;renderLibraryHome()}if(typeof GUI.libraryhome.CDinput!=="undefined"&&typeof GUI.libraryhome.CDinput.status!=="undefined"&&Object.keys(GUI.libraryhome.CDinput.status).length){$("#eject").removeClass("hide");$("#eject").removeClass("disabled")}else{$("#eject").addClass("hide")}}function renderModal(e){toggleLoader("close");if(typeof isLocalHost==="undefined"||!isLocalHost){var a=e[0];$("#"+a.id).on("hidden.bs.modal",function(){$(this).find("input").val("")});$("#"+a.id).modal()}}function playbackChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode,reconnectOnChannelUnavailableInterval:5e3});e.onmessage=renderUI;e.onstatuschange=function(e){if(e===2){$("#loader").addClass("hide");sendCmd("renderui")}else{if(e===0){toggleLoader()}}};e.addChannel("playback");e.connect()}function queueChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=getPlaylist;e.addChannel("queue");e.connect()}function libraryChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=libraryHome;e.addChannel("library");e.connect()}function notifyChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=renderMSG;e.addChannel("notify");e.connect()}function modalChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=renderModal;e.addChannel("modal");e.connect()}function overlayTrigger(i){var o=$(i),e=$(i+"-open"),a=$(i+"-close");transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};function s(){if(o.hasClass("open")){o.removeClass("open");o.addClass("closed");var a=function(e){if(support.transitions){if(e.propertyName!=="visibility"){return}this.removeEventListener(transEndEventName,a)}o.removeClass("closed")}}else if(o.hasClass("closed")){o.addClass("open");if(i==="#overlay-social"){var e="https://twitter.com/home?status=Listening+to+"+GUI.json.currentsong.replace(/\s+/g,"+")+"+by+"+GUI.json.currentartist.replace(/\s+/g,"+")+"+on+%40RuneAudio+http%3A%2F%2Fwww.runeaudio.com%2F+%23nowplaying";var s="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.runeaudio.com%2F&display=popup";var t="https://plus.google.com/share?url=http%3A%2F%2Fwww.runeaudio.com%2F";$("#urlTwitter").attr("href",e);$("#urlFacebook").attr("href",s);$("#urlGooglePlus").attr("href",t)}}}e.click(function(){s()});a.click(function(){s()})}function getHiddenProp(){var e=["webkit","moz","ms","o"];if("hidden"in document){return"hidden"}for(var a=0;a<e.length;a++){if(e[a]+"Hidden"in document){return e[a]+"Hidden"}}return null}function isHidden(){var e=getHiddenProp();if(!e){return false}return document[e]}function visChange(){if(isHidden()){GUI.visibility="hidden"}else{GUI.visibility="visible"}}if($("#section-index").length){jQuery(document).ready(function(n){"use strict";GUI.mode=checkWebSocket();playbackChannel();libraryChannel();PNotify.prototype.options.styling="fontawesome";PNotify.prototype.options.stack.dir1="up";PNotify.prototype.options.stack.dir2="left";PNotify.prototype.options.stack.firstpos1=90;PNotify.prototype.options.stack.firstpos2=50;PNotify.prototype.options.stack.spacing1=10;PNotify.prototype.options.stack.spacing2=10;notifyChannel();modalChannel();var e=getHiddenProp();if(e){var a=e.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(a,visChange)}n(window).ready(function(){updateGUI()});n(".btn-cmd").click(function(){var e=n(this);commandButton(e)});n("#eject").click(function(){n("#eject").addClass("disabled");n.post("/db/?cmd=eject","")});var s;var t;n("#volumedn").on("mouseleave mouseout mouseup",function(){clearInterval(s);return false});n("#volumedn").mousedown(function(){t=300;s=setInterval(i,t+200);return false});function i(){clearInterval(s);t=t-10;if(t<50){t=50}s=setInterval(i,t);var e;var a=parseInt(n("#volume").val());if(parseInt(GUI.volume)>0){e=parseInt(GUI.volume)-1;GUI.volume=e;n("#volumemute").removeClass("btn-primary")}if(e>=0&&e<=100){setvol(e);n("#volume").val(e,false).trigger("update")}}n("#volumeup").on("mouseleave mouseout mouseup",function(){clearInterval(s);return false});n("#volumeup").mousedown(function(){t=300;s=setInterval(o,t+200);return false});function o(){clearInterval(s);t=t-10;if(t<50){t=50}s=setInterval(o,t);var e;var a=parseInt(n("#volume").val());if(parseInt(GUI.volume)<100){e=parseInt(GUI.volume)+1;GUI.volume=e;n("#volumemute").removeClass("btn-primary")}if(e>=0&&e<=100){setvol(e);n("#volume").val(e,false).trigger("update")}}n("#volume").click(function(){n("#volumemute").click()});n("#countdown-display").click(function(){sendCmd("pause")});n("#total").click(function(){sendCmd("pause")});n("#random").click(function(){n("#random").attr("data-cmd","random");n("#random").attr("title","Random");n("#random").removeClass("btn-primary")});n("#panel-sx").click(function(){addPlayerScrollbars()});n("#panel-dx").click(function(){addPlayerScrollbars()});n("button#songinfo-open").click(function(){addPlayerScrollbars()});n("#playback").click(function(){removePlayerScrollbars()});n("button#songinfo-close-x").click(function(){removePlayerScrollbars()});n("button#songinfo-close-cancel").click(function(){removePlayerScrollbars()});n("#time").knob({inline:false,change:function(e){if(GUI.state!=="stop"){window.clearInterval(GUI.currentKnob)}else{n("#time").val(0).trigger("change")}},release:function(e){onreleaseKnob(e)}});var l=n("#volume").data("dynamic");n("#volume").knob({inline:false,change:function(e){var a=parseInt(e);if(a>GUI.maxvol-4&&GUI.checkvol<GUI.minvol+5){n("#volume").val(0);if(l){n(document).mouseup()}return false}else if(a<GUI.minvol+4&&GUI.checkvol>GUI.maxvol-5){n("#volume").val(100);if(l){n(document).mouseup()}return false}if(l&&a!==GUI.volume){setvol(a)}GUI.checkvol=a},release:function(e){var a=parseInt(e);if(!l&&a!==GUI.volume){setvol(a)}},draw:function(){if(this.$.data("skin")==="tron"){this.cursorExt=.05;var e=this.arc(this.cv),a,s=1;this.g.lineWidth=this.lineWidth;if(this.o.displayPrevious){a=this.arc(this.v);this.g.beginPath();this.g.strokeStyle=this.pColor;this.g.arc(this.xy,this.xy,this.radius-this.lineWidth,a.s,a.e,a.d);this.g.stroke()}this.g.beginPath();this.g.strokeStyle=s?this.o.fgColor:this.fgColor;this.g.arc(this.xy,this.xy,this.radius-this.lineWidth,e.s,e.e,e.d);this.g.stroke();this.g.lineWidth=2;this.g.beginPath();this.g.strokeStyle=this.o.fgColor;this.g.arc(this.xy,this.xy,this.radius-this.lineWidth+this.radius/5+this.lineWidth*2/3,0,2*Math.PI,false);this.g.stroke();return false}}});var r=n("#playlist-entries");r.on("click","li",function(e){var a="";if(n(e.target).hasClass("pl-action")){e.preventDefault();var s=n(this).attr("id");s=parseInt(s.replace("pl-",""));a="deleteid "+s;sendCmd(a)}else{var t=n("li","#playlist-entries").index(this);a="play "+t;sendCmd(a);n("li.active","#playlist-entries").removeClass("active");n(this).addClass("active")}});n("a","#open-panel-dx").click(function(){if(n("#open-panel-dx").hasClass("active")){var e=parseInt(GUI.json.song);customScroll("pl",e,500);if(!n("#pl-filter-results").hasClass("hide"))n("#pl-filter-results").click()}}).on("shown.bs.tab",function(e){var a=parseInt(GUI.json.song);customScroll("pl",a,0)});n("#open-library").click(function(){n("#open-panel-dx").removeClass("active");n("#open-panel-sx").addClass("active")});n("#pl-filter").keyup(function(){n.scrollTo(0,500);var a=n(this).val(),s=0;n("li","#playlist-entries").each(function(){var e=n(this);if(e.text().search(new RegExp(a,"i"))<0){e.hide()}else{e.show();s++}});var e=s;var t=s===1?"":"s";if(a!==""){n("#pl-count").addClass("hide");n("#pl-filter-results").removeClass("hide").html('<i class="fa fa-times sx"></i><span class="visible-xs-inline">back</span><span class="hidden-xs">'+ +s+" result"+t+' for "<span class="keyword">'+a+'</span>"</span>')}else{n("#pl-count").removeClass("hide");n("#pl-filter-results").addClass("hide").html("")}});n("#pl-filter-results").click(function(){n(this).addClass("hide");n("#pl-count").removeClass("hide");if(n(this).hasClass("back-to-queue")){n(".playlist").addClass("hide");getPlaylistCmd();n("#pl-currentpath").addClass("hide");n("#pl-manage").removeClass("hide")}else{n("li","#playlist-entries").each(function(){var e=n(this);e.show()});n("#pl-currentpath").removeClass("hide");n("#pl-filter").val("")}customScroll("pl",parseInt(GUI.json.song),500)});n("#pl-manage-list").click(function(){getPlaylists()});n("#modal-pl-save-btn").click(function(){var e=n("#pl-save-name").val();n.post("/db/?cmd=pl-save",{playlist:e})});n("#pl-editor").on("click",".pl-action",function(e){e.preventDefault();var a=n(this).parent().attr("data-path");GUI.DBentry[0]=a});n("#pl-rename-button").click(function(){var e=n("#pl-rename-oldname").text();var a=n("#pl-rename-name").val();n.post("/db/?cmd=pl-rename",{oldname:e,newname:a},function(){getPlaylists()})});n("#pl-ashuffle-start-button").click(function(){n.post("/db/?cmd=pl-ashuffle-start","")});n("#pl-ashuffle-stop-button").click(function(){n.post("/db/?cmd=pl-ashuffle-stop","")});n("#pl-ashuffle-reset-button").click(function(){n.post("/db/?cmd=pl-ashuffle-reset","")});n("#pl-clear-played-button").click(function(){n.post("/db/?cmd=pl-clear-played","")});n("#pl-crop-button").click(function(){n.post("/db/?cmd=pl-crop","")});n("#pl-manage-save").click(function(){getPlaylistsDropdown()});var d=document.getElementById("playlist-entries");new Sortable(d,{ghostClass:"sortable-ghost",onUpdate:function(e){sortOrder(e.item.getAttribute("id"))}});n("a","#open-panel-sx").click(function(){if(n("#open-panel-sx").hasClass("active")){customScroll("pl",parseInt(GUI.json.song),500)}}).on("shown.bs.tab",function(e){customScroll("db",GUI.currentDBpos[GUI.currentDBpos[10]],0)});n("#home-blocks").on("click",".home-block",function(e){if(!n(this).hasClass("inactive")){if(n(e.target).is("span.block-remove")){var a=n(this).attr("id");a=a.replace("home-bookmark-","");var s=n(this).find("h3").text();n.post("/db/?cmd=bookmark",{id:a,name:s})}else{++GUI.currentDBpos[10];getDB({browsemode:n(this).data("browsemode"),path:n(this).data("path"),uplevel:0,plugin:n(this).data("plugin")})}}else{n("#overlay-playsource-open").trigger("click")}});n("#db-homeSetup").click(function(){var e=n(this);if(e.hasClass("btn-primary")){e.removeClass("btn-primary").addClass("btn-default");n(".home-block-remove").remove()}else{e.removeClass("btn-default").addClass("btn-primary");n(".home-block.home-bookmark").append('<div class="home-block-remove" title="Remove this bookmark"><span class="block-remove">&times;</span></div>')}});var c=n("#database-entries");c.on("click","li",function(e){var a="",s="";var t=n(this);if(n(e.target).hasClass("db-action")){e.preventDefault();a=t.data("path");GUI.DBentry[0]=a}else{n("li.active","#database-entries").removeClass("active");t.addClass("active");if(t.hasClass("db-folder")){a=t.data("path");if(t.hasClass("db-album")){if(a!==""){getDB({path:a,uplevel:0,browsemode:"album"})}else{a=GUI.currentDBpath[GUI.currentDBpos[10]-1];getDB({path:a,uplevel:0,browsemode:"albumfilter"})}}else if(t.hasClass("db-artist")){getDB({path:a,uplevel:0,browsemode:"artist"})}else if(t.hasClass("db-composer")){getDB({path:a,uplevel:0,browsemode:"composer"})}else if(t.hasClass("db-genre")){getDB({path:a,uplevel:0,browsemode:"genre"})}else if(t.hasClass("db-dirble")){a=GUI.currentpath+"/"+t.find("span").text();var i=t.hasClass("db-dirble-child")?"stations":"childs";getDB({path:a,plugin:"Dirble",querytype:i,args:t.data("path")});GUI.plugin="Dirble"}else if(t.hasClass("db-jamendo")){}else{s=t.data("browsemode");getDB({path:a,uplevel:0,browsemode:s})}var o=t.attr("id");o=o.replace("db-","");GUI.currentDBpos[GUI.currentDBpos[10]]=o;GUI.currentDBpath[GUI.currentDBpos[10]]=a;++GUI.currentDBpos[10]}else if(t.hasClass("db-webradio-add")){n("#modal-webradio-add").modal()}}});c.on("dblclick","li",function(e){var a=n(this);if(!n(e.target).hasClass("db-action")){n("li.active","#database-entries").removeClass("active");a.addClass("active");var s=a.data("path");s=a.hasClass("db-dirble")?s.split(" | ")[1]:s;getDB({cmd:"addplay",path:s})}});n("#db-level-up").click(function(){--GUI.currentDBpos[10];var e=GUI.currentpath;if(GUI.currentDBpos[10]===0){e=""}else{if(GUI.browsemode==="file"){var a=e.lastIndexOf("/");e=a!==-1?e.slice(0,a):""}else{if(GUI.browsemode==="album"){e=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(e===""){e="Albums"}else{GUI.browsemode="artist"}}else if(GUI.browsemode==="artist"){e=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(e===""){e="Artists"}else{GUI.browsemode="genre"}}else if(GUI.browsemode==="composer"){e=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(e===""){e="Composer"}else{GUI.browsemode="artist"}}else if(GUI.browsemode==="genre"){e="Genres"}else if(GUI.browsemode==="albumfilter"){GUI.browsemode="artist";e=GUI.currentDBpath[GUI.currentDBpos[10]-1]}}}getDB({browsemode:GUI.browsemode,path:e,plugin:GUI.plugin,uplevel:1});GUI.plugin=""});n("#db-search-results").click(function(){n(this).addClass("hide");n("#db-level-up").removeClass("hide");getDB({path:GUI.currentpath})});n("a",".context-menu").click(function(){var e=n(this).data("cmd");var a=n(this).data("type");var s=GUI.DBentry[0];GUI.DBentry[0]="";switch(e){case"pl-add":sendCmd('load "'+s+'"');break;case"pl-replace":sendCmd("clear");sendCmd('load "'+s+'"');break;case"pl-addreplaceplay":sendCmd("clear");sendCmd('load "'+s+'"');sendCmd("play");break;case"pl-rename":n("#modal-pl-rename").modal();n("#pl-rename-oldname").text(s);break;case"pl-rm":n.ajax({url:"/command/?cmd=rm%20%22"+s+"%22",success:function(e){getPlaylists(e)},cache:false});break;case"pl-rem-dup":n.post("/db/?cmd=pl-rem-dup",{playlist:s});break;case"pl-rem-invalid":n.post("/db/?cmd=pl-rem-invalid",{playlist:s});break;case"pl-ashuffle":n.post("/db/?cmd=pl-ashuffle",{playlist:s},function(){getPlaylists()});break;case"wradd":s=s.split(" | ")[1];getDB({cmd:"add",path:s});break;case"wraddplay":s=s.split(" | ")[1];getDB({cmd:"addplay",path:s});break;case"wraddreplaceplay":s=s.split(" | ")[1];getDB({cmd:"addreplaceplay",path:s});break;case"wredit":n("#modal-webradio-edit").modal();n.post("/db/?cmd=readradio",{filename:s},function(e){var a=n("#webradio-edit-name");a.val(e.name);a.data("file-name",e.name);n("#webradio-edit-url").val(e.url)},"json");break;case"wrdelete":n("#modal-webradio-delete").modal();n("#webradio-delete-name").text(s.replace("Webradio/",""));break;case"wrsave":var t=s.split(" | ");n.post("/db/?cmd=addradio",{"radio[label]":t[0],"radio[url]":t[1]});break;default:getDB({cmd:e,path:s,browsemode:GUI.browsemode,querytype:a});break}});n("#webradio-add-button").click(function(){var e=n("#webradio-add-name").val();var a=n("#webradio-add-url").val();if(e===""||a===""){renderMSG([{title:"Missing fields",text:"Please fill both fields to continue",icon:"fa fa-warning"}])}else{n.post("/db/?cmd=addradio",{"radio[label]":e,"radio[url]":a},function(e){},"json");n("#modal-webradio-add").modal("hide");n("#webradio-add-name").val("");n("#webradio-add-url").val("")}});n("#webradio-edit-button").click(function(){var e=n("#webradio-edit-name");n.post("/db/?cmd=editradio",{"radio[newlabel]":e.val(),"radio[label]":e.data("file-name"),"radio[url]":n("#webradio-edit-url").val()},function(e){},"json")});n("#webradio-delete-button").click(function(){var e=n("#webradio-delete-name").text();n.post("/db/?cmd=deleteradio",{"radio[label]":e},function(e){},"json")});n("#db-firstPage").click(function(){n.scrollTo(0,500)});n("#db-prevPage").click(function(){var e=parseInt(n(window).height())-184;var a="-="+e.toString()+"px";n.scrollTo(a,500)});n("#db-nextPage").click(function(){var e=parseInt(n(window).height())-184;var a="+="+e.toString()+"px";n.scrollTo(a,500)});n("#db-lastPage").click(function(){n.scrollTo("100%",500)});n("#pl-firstPage").click(function(){n.scrollTo(0,500)});n("#pl-prevPage").click(function(){var e=parseInt(n(window).height())-184;var a="-="+e.toString()+"px";n.scrollTo(a,500)});n("#pl-nextPage").click(function(){var e=parseInt(n(window).height())-184;var a="+="+e.toString()+"px";n.scrollTo(a,500)});n("#pl-lastPage").click(function(){n.scrollTo("100%",500)});var p=document.location.toString();if(p.match("#")){n('#menu-bottom a[href="/#'+p.split("#")[1]+'"]').tab("show")}n("#menu-bottom a").on("shown",function(e){if(history.pushState){history.pushState(null,null,e.target.hash)}else{window.location.hash=e.target.hash}}).on("click",function(){if(n("#overlay-social").hasClass("open")){n(".overlay-close").trigger("click")}});if(n(".ttip").length){n(".ttip").tooltip()}FastClick.attach(document.body);n("#syscmd-poweroff").click(function(){n.post("/settings/",{syscmd:"poweroff"});toggleLoader()});n("#syscmd-reboot").click(function(){n.post("/settings/",{syscmd:"reboot"});toggleLoader()});n("#syscmd-display_off").click(function(){n.post("/settings/",{syscmd:"display_off"})});n("#sec-linux_password").keyup(function(){var e=n("#sec-linux_password").val();var a=e.replace(/\s/g,"");if(e===a&&e.length>=8&&e.length<=255){n("#security-linux_password_save").removeClass("disabled")}else{n("#security-linux_password_save").addClass("disabled")}});n("#sec-ap_password").keyup(function(){var e=n("#sec-ap_password").val();var a=e.replace(/\s/g,"");if(e&&e===a&&e.length>=8&&e.length<=63){n("#security-ap_password_save").removeClass("disabled")}else{n("#security-ap_password_save").addClass("disabled")}});n("#security-linux_password_save").click(function(){var e=n("#sec-linux_password").val();var a=e.replace(/\s/g,"");if(e===a&&e.length>=8&&e.length<=255){n.post("/settings/",{syscmd:"security",action:"linux_password_save",args:e})}n("#sec-linux_password").val("")});n("#security-linux_password_randomise").click(function(){n.post("/settings/",{syscmd:"security",action:"linux_password_randomise",args:""})});n("#security-ap_password_save").click(function(){var e=n("#sec-ap_password").val();var a=e.replace(/\s/g,"");if(e&&e===a&&e.length>=8&&e.length<=63){n.post("/settings/",{syscmd:"security",action:"ap_password_save",args:e})}});overlayTrigger("#overlay-social");overlayTrigger("#overlay-playsource");n("#playsource-mpd").click(function(){if(n(this).hasClass("inactive")){GUI.forceGUIupdate=true;n.ajax({url:"/command/?switchplayer=MPD",cache:false})}n("#overlay-playsource-close").trigger("click")});if(document.location.hostname=="localhost")n(".osk-trigger").onScreenKeyboard({draggable:true})})}else{jQuery(document).ready(function(i){"use strict";GUI.mode=checkWebSocket();playbackChannel();PNotify.prototype.options.styling="fontawesome";PNotify.prototype.options.stack.dir1="up";PNotify.prototype.options.stack.dir2="left";PNotify.prototype.options.stack.firstpos1=90;PNotify.prototype.options.stack.firstpos2=50;PNotify.prototype.options.stack.spacing1=10;PNotify.prototype.options.stack.spacing2=10;notifyChannel();i(".btn-cmd").click(function(){var e=i(this);commandButton(e)});i("#syscmd-poweroff").click(function(){i.post("/settings/",{syscmd:"poweroff"});toggleLoader()});i("#syscmd-reboot").click(function(){i.post("/settings/",{syscmd:"reboot"});toggleLoader()});i("#syscmd-display_off").click(function(){i.post("/settings/",{syscmd:"display_off"})});i(".selectpicker").selectpicker();if(i("#section-sources").length){if(i("#mount-type").val()==="nfs"){i("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide")}i("#mount-type").change(function(){if(i(this).val()==="cifs"||i(this).val()==="osx"){i("#mount-cifs").removeClass("disabled").children(".disabler").addClass("hide")}else{i("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide")}});i("#nas-guest").change(function(){if(i(this).prop("checked")){i("#mount-auth").addClass("disabled").children(".disabler").removeClass("hide")}else{i("#mount-auth").removeClass("disabled").children(".disabler").addClass("hide")}});i("#nas-advanced").change(function(){if(i(this).prop("checked")){i("#mount-advanced-config").removeClass("hide")}else{i("#mount-advanced-config").addClass("hide")}});i("#show-mount-advanced-config").click(function(e){e.preventDefault();if(i(this).hasClass("active")){i("#mount-advanced-config").toggleClass("hide");i(this).removeClass("active");i(this).find("i").removeClass("fa fa-minus-circle").addClass("fa fa-plus-circle");i(this).find("span").html("show advanced options")}else{i("#mount-advanced-config").toggleClass("hide");i(this).addClass("active");i(this).find("i").removeClass("fa fa-plus-circle").addClass("fa fa-minus-circle");i(this).find("span").html("hide advanced options")}});i("#usb-mount-list a").click(function(){var e=i(this).data("mount");i("#usb-umount-name").html(e);i("#usb-umount").val(e)})}if(i("#section-settings").length){i("#airplay").change(function(){if(i(this).prop("checked")){i("#airplayName").removeClass("hide");i("#airplayBox").addClass("boxed-group")}else{i("#airplayName").addClass("hide");i("#airplayBox").removeClass("boxed-group")}});i("#scrobbling-lastfm").change(function(){if(i(this).prop("checked")){i("#lastfmAuth").removeClass("hide");i("#lastfmBox").addClass("boxed-group")}else{i("#lastfmAuth").addClass("hide");i("#lastfmBox").removeClass("boxed-group")}});i("#proxy").change(function(){if(i(this).prop("checked")){i("#proxyAuth").removeClass("hide");i("#proxyBox").addClass("boxed-group")}else{i("#proxyAuth").addClass("hide");i("#proxyBox").removeClass("boxed-group")}});i("#dlna").change(function(){if(i(this).prop("checked")){i("#dlnaName").removeClass("hide");i("#dlnaBox").addClass("boxed-group")}else{i("#dlnaName").addClass("hide");i("#dlnaBox").removeClass("boxed-group")}});i("#local_browser").change(function(){if(i(this).prop("checked")){i("#local_browserName").removeClass("hide");i("#local_browserBox").addClass("boxed-group")}else{i("#local_browserName").addClass("hide");i("#local_browserBox").removeClass("boxed-group")}});i("#cdinput").change(function(){if(i(this).prop("checked")){i("#cdDetails").removeClass("hide");i("#cdBox").addClass("boxed-group")}else{i("#cdDetails").addClass("hide");i("#cdBox").removeClass("boxed-group")}});i("#dlnaTidal").change(function(){if(i(this).prop("checked")){i("#dlnaTidalName").removeClass("hide");i("#dlnaTidalBox").addClass("boxed-group")}else{i("#dlnaTidalName").addClass("hide");i("#dlnaTidalBox").removeClass("boxed-group")}});i("#dlnaGoogle").change(function(){if(i(this).prop("checked")){i("#dlnaGoogleName").removeClass("hide");i("#dlnaGoogleBox").addClass("boxed-group")}else{i("#dlnaGoogleName").addClass("hide");i("#dlnaGoogleBox").removeClass("boxed-group")}});i("#dlnaQobuz").change(function(){if(i(this).prop("checked")){i("#dlnaQobuzName").removeClass("hide");i("#dlnaQobuzBox").addClass("boxed-group")}else{i("#dlnaQobuzName").addClass("hide");i("#dlnaQobuzBox").removeClass("boxed-group")}});i("#spotifyconnect").change(function(){if(i(this).prop("checked")){i("#spotifyconnectAuth").removeClass("hide");i("#spotifyconnectBox").addClass("boxed-group")}else{i("#spotifyconnectAuth").addClass("hide");i("#spotifyconnectBox").removeClass("boxed-group")}});i("#samba").change(function(){if(i(this).prop("checked")){i("#sambaAuth").removeClass("hide");i("#sambaBox").addClass("boxed-group")}else{i("#sambaAuth").addClass("hide");i("#sambaBox").removeClass("boxed-group")}});i("#bluetooth").change(function(){if(i(this).prop("checked")){i("#bluetoothAuth").removeClass("hide");i("#bluetoothBox").addClass("boxed-group")}else{i("#bluetoothAuth").addClass("hide");i("#bluetoothBox").removeClass("boxed-group")}});i(".btn-file :file").on("fileselect",function(e,a,s){var t=i(this).parents(".input-group").find(":text");if(t.length){t.val(s)}else{if(s){if(s.indexOf(".tar.gz")>-1){i("#backup-file").html(' <i class="fa fa-check dx green"></i> '+s+"");i("#btn-backup-upload").prop("disabled",false)}else{i("#backup-file").html(' <i class="fa fa-times dx red"></i> not a valid backup file, must be: .tar.gx');i("#btn-backup-upload").prop("disabled",true)}}}})}if(i("#section-network").length){var e=i("#network-manual-config");if(i("#dhcp").val()==="Static"){e.removeClass("hide")}i("#dhcp").change(function(){if(i(this).val()==="Static"){e.removeClass("hide")}else{e.addClass("hide")}});i("#wifiProfiles").change(function(){if(i(this).prop("checked")){i("#wifiProfilesBox").addClass("hide")}else{i("#wifiProfilesBox").removeClass("hide")}});i("#wifiEdit").change(function(){if(i(this).prop("checked")){i("#networkConfiguration").removeClass("hide");i("#wifiEditButton").removeClass("btn-primary");i("#wifiEditButton").addClass("btn-default")}else{i("#networkConfiguration").addClass("hide");i("#wifiEditButton").removeClass("btn-default");i("#wifiEditButton").addClass("btn-primary")}})}if(i("#section-accesspoint").length){i("#accesspoint").change(function(){if(i(this).prop("checked")){i("#accesspointSettings").removeClass("hide");i("#accesspointBox").addClass("boxed-group")}else{i("#accesspointSettings").addClass("hide");i("#accesspointBox").removeClass("boxed-group")}});i("#ip-address").change(function(){var e=i("#ip-address").val().split(".");e[3]++;i("#dhcp-range").val(e.join(".")+","+e[0]+"."+e[1]+"."+e[2]+".254,24h");e[3]=255;i("#broadcast").val(e.join("."));i("#dhcp-option-dns").val(i("#ip-address").val());i("#dhcp-option-router").val(i("#ip-address").val())})}if(i("#section-mpd").length){i("#audio-output-interface").change(function(){renderMSG([{title:"Switching audio output",text:"Please wait for the config update...",icon:"fa fa-cog fa-spin",delay:5e3}]);var e=i(this).val();i.ajax({type:"POST",url:"/mpd/",data:{ao:e},cache:false})});i(".manual-edit-confirm").find(".btn-primary").click(function(){i("#mpdconf_editor").removeClass("hide");i("#manual-edit-warning").addClass("hide")});i("#mpd-gr-cb").change(function(){if(i(this).prop("checked")){i("#mpd-gr-fields").removeClass("hide");i("#grBox").addClass("boxed-group")}else{i("#mpd-gr-fields").addClass("hide");i("#grBox").removeClass("boxed-group")}})}if(i("#section-debug").length){i("#copyText").click(function(){i("#text2copy").html(document.getElementById("text2display").innerText);i("#text2copy").removeClass("hide");i("#text2copy").select();document.execCommand("copy");i("#text2copy").addClass("hide");new PNotify({title:"Copied to clipboard",text:"The debug output was copied successfully in your clipboard.",icon:"fa fa-check"})})}if(document.location.hostname=="localhost")i(".osk-trigger").onScreenKeyboard({draggable:true})});$(document).on("change",".btn-file :file",function(){var e=$(this),a=e.get(0).files?e.get(0).files.length:1,s=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[a,s])})}