var GUI={DBentry:["","",""],DBupdate:false,activePlayer:"",browsemode:"file",checkvol:0,currentDBpos:[0,0,0,0,0,0,0,0,0,0,0],currentDBpath:["","","","","","","","","","",""],currentalbum:"",currentartist:"",currentsong:"",currentknob:null,currentpath:"",json:0,libraryhome:"",forceGUIupdate:false,maxvol:100,minvol:0,mode:"websocket",noticeUI:{},playlist:null,plugin:"",state:"",stepVolumeDelta:0,stepVolumeInt:0,stream:"",visibility:"visible",vol_changed_local:0,volume:null,clientUUID:null,mainArtURL:"",smallArtURL:"",bigArtURL:"",song_lyrics:"",time:0,elapsed:0,consume:0,file:"",local_volume_control:""};function generateUUID(){var s=(new Date).getTime();var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=(s+Math.random()*16)%16|0;s=Math.floor(s/16);return(e=="x"?a:a&3|8).toString(16)});return e}function sendCmd(e){$.ajax({type:"GET",url:"/command/?cmd="+e+"&clientUUID="+GUI.clientUUID,cache:false})}function htmlDecode(e){var a=(new DOMParser).parseFromString(e,"text/html");return a.documentElement.textContent}function htmlEncode(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function checkWebSocket(){if(window.WebSocket){return"websocket"}else{return"longpolling"}}function checkWorkers(){if(window.Worker&&window.Blob||Modernizr.webworkers&&Modernizr.blobconstructor){return true}else{return false}}function parsePath(e){var a=e&&e.length?e.lastIndexOf("/"):0;var s="";if(a&&a!==-1){s=e.slice(0,a)}return s}var idleTime=0;var viewScreenSaver=0;var widthScreenSaver=0;var isLocalHost=0;var SStime=-1;$(document).ready(function(){GUI.clientUUID=generateUUID();if($("#section-index").length){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"){isLocalHost=1;SStime=localSStime}else{isLocalHost=0;SStime=remoteSStime}if(SStime>=0){var e=setInterval(timerIncrement,1e3)}$(this).on("mousemove click keypress",function(e){idleTime=0;if(viewScreenSaver){$(".tab-content").show("slow");if(smallScreenSaver&&isLocalHost){$(".small-screen-saver-content").hide("slow")}else{$(".screen-saver-content").hide("slow")}$("#menu-bottom").show("slow");$("#menu-top").show("slow");viewScreenSaver=0}})}});function timerIncrement(){if($("#section-index").length&&GUI.state==="play"&&!$("#panel-sx").hasClass("active")&&!$("#panel-dx").hasClass("active")){idleTime=idleTime+1}else{idleTime=0}if(idleTime>SStime){removePlayerScrollbars();$(".tab-content").hide("slow");if(smallScreenSaver&&isLocalHost){$(".small-screen-saver-content").show("slow")}else{$(".screen-saver-content").show("slow")}$("#menu-bottom").hide("slow");$("#menu-top").hide("slow");viewScreenSaver=1}}function checkPlayerState(){if($("#playback").hasClass("active")){removePlayerScrollbars()}else{addPlayerScrollbars()}}function removePlayerScrollbars(){$("html").addClass("disable-scrollbar-0");$("#section-index").addClass("disable-scrollbar-1");$("#section-index").addClass("disable-scrollbar-2")}function addPlayerScrollbars(){$("html").removeClass("disable-scrollbar-0");$("#section-index").removeClass("disable-scrollbar-1");$("#section-index").removeClass("disable-scrollbar-2")}function refreshTimer(e,a=null,s){var t=$("#countdown-display");if(typeof t.countdown!=="undefined"){t.countdown("destroy");t.countdown({since:s!=="stop"||s!==undefined?-e:0,compact:true,format:"MS"});if(s==="play"){t.countdown("resume")}else{t.countdown("pause")}}var o=$("#countdown-display-ss");if(typeof o.countdown!=="undefined"){o.countdown("destroy");o.countdown({since:s!=="stop"||s!==undefined?-e:0,compact:true,format:"MS"});if(s==="play"){o.countdown("resume")}else{o.countdown("pause")}}var i=$("#countdown-display-sss");if(typeof i.countdown!=="undefined"){i.countdown("destroy");i.countdown({since:s!=="stop"||s!==undefined?-e:0,compact:true,format:"MS"});if(s==="play"){i.countdown("resume")}else{i.countdown("pause")}}}function refreshKnob(){if(typeof GUI.json.song_percent!=="undefined"){var e=parseInt(GUI.json.song_percent)*10}if(typeof GUI.json.time!=="undefined"){var a=parseInt(GUI.json.time);var s=parseInt(1e3/a)}var t=$(".countdown-amount").html();var o=$("#time");window.clearInterval(GUI.currentKnob);o.val(e,false).trigger("update");if(GUI.state==="play"){GUI.currentKnob=setInterval(function(){e=e+(GUI.visibility!=="visible"?s:1);o.val(e,false).trigger("update")},a)}}function timeConvert(e){var a=Math.floor(e/60);e-=a*60;var s=a<10?"0"+a:a;var t=e<10?"0"+e:e;return s+":"+t}function timeConvert2(e){var a=Math.floor(e/3600);var s=Math.floor((e-a*3600)/60);e=Math.floor(e-a*3600-s*60);if(a>0){if(a<10){a="0"+a}a+=":"}else{a=""}if(s<10){s="0"+s}if(e<10){e="0"+e}return a+s+":"+e}function timeConvert3(e){var a=Math.floor(e/3600);var s=Math.floor((e-a*3600)/60);e=Math.floor(e-a*3600-s*60);if(a>0){if(a<10){a="0"+a}a+="h "}else{a=""}if(s<10){s="0"+s}if(e<10){e="0"+e}return a+s+"m "+e+"s"}function countdownRestart(e){var a=$("#countdown-display").countdown("destroy");a.countdown({since:-e,compact:true,format:"MS"});var s=$("#countdown-display-ss").countdown("destroy");s.countdown({since:-e,compact:true,format:"MS"});var t=$("#countdown-display-sss").countdown("destroy");t.countdown({since:-e,compact:true,format:"MS"})}function reset_vol_changed_local(){GUI.vol_changed_local=0}function setvol(e){GUI.volume=e;$("#volumemute").removeClass("btn-primary");sendCmd("setvol "+e);if(GUI.vol_changed_local===0){setInterval(reset_vol_changed_local,5e3);GUI.vol_changed_local=1}}function volumeStepCalc(a){var s=0;var e=a;GUI.volume=parseInt($("#volume").val());var t=function volumeStepCycle(e){s++;if(a==="up"){GUI.stepVolumeDelta=parseInt(GUI.volume)+s}else if(a==="dn"){GUI.stepVolumeDelta=parseInt(GUI.volume)-s}$("#volume").val(GUI.stepVolumeDelta).trigger("change")};t();GUI.stepVolumeInt=window.setInterval(function(){t()},200)}function volumeStepSet(){window.clearInterval(GUI.stepVolumeInt);setvol(GUI.stepVolumeDelta)}function customScroll(e,a,s){if(typeof s==="undefined"){s=500}var t=49;var o=parseInt($(window).height()/2);var i=$(window).scrollTop();var l=0;var n=0;if(e==="db"){l=parseInt(a*t-o);n=l}else if(e==="pl"){l=parseInt((a+2)*t-o);n=Math.abs(l-i);n=(l>i?"+":"-")+"="+n+"px";$("#playlist-entries").find("li").eq(a).addClass("active")}$.scrollTo(l>0?n:0,s)}function randomScrollPL(){var e=$(".playlist li").size();var a=1+Math.floor(Math.random()*e);customScroll("pl",a)}function randomScrollDB(){var e=$(".database li").size();var a=1+Math.floor(Math.random()*e);customScroll("db",a)}function toggleLoader(e){if(e==="close"){$("#loader").addClass("hide")}else{if($("#section-dev").length){$("#loader").addClass("hide");new PNotify({title:"Warning",text:"The loading layer (spinning arrows) points to a socket error",icon:"fa fa-exclamation-circle"})}else{$("#loader").removeClass("hide")}}}function customNotify(e){if(e.custom==="kernelswitch"){if(GUI.noticeUI.kernelswitch!==undefined){GUI.noticeUI.kernelswitch.remove()}GUI.noticeUI.kernelswitch=new PNotify({title:"title"in e?e.title:"[missing title]",text:"text"in e?e.text:"[missing text]",icon:"fa fa-refresh",hide:false,confirm:{confirm:true,buttons:[{text:e.btntext,addClass:"btn-default btn-block  uppercase",click:function(){$.post("/settings/",{syscmd:"reboot"});toggleLoader()}},{text:"Cancel",addClass:"hide"}]},buttons:{closer:false,sticker:false}})}}function renderMSG(e){var a=e[0];if("custom"in a&&a.custom!==null){customNotify(a);return}var s={title:"title"in a?a.title:"[missing title]",text:"text"in a?a.text:"[missing text]",icon:a.icon===undefined?"fa fa-check":a.icon,opacity:a.opacity===undefined?.9:a.opacity,hide:a.hide===undefined&&a.permanotice===undefined,buttons:{closer:a.permanotice===undefined,sticker:a.permanotice===undefined},delay:a.delay===undefined?8e3:a.delay,mouse_reset:false};if("permanotice"in a){if(GUI.noticeUI[a.permanotice]===undefined){GUI.noticeUI[a.permanotice]=new PNotify(s)}else{if("permaremove"in a){GUI.noticeUI[a.permanotice].remove();GUI.noticeUI[a.permanotice]=undefined}else{GUI.noticeUI[a.permanotice].open()}}}else{new PNotify(s)}$(".ui-pnotify").on("click",".ui-pnotify-text",function(){$(this).parent().parent().remove()})}function sortOrder(e){var a=$("#"+e).index();e=parseInt(e.replace("pl-",""));sendCmd("moveid "+e+" "+a)}function loadingSpinner(e,a){if(a==="hide"){if(e==="db"){$("#spinner-db").addClass("hide")}if(e==="pl"){$("#spinner-pl").addClass("hide")}}else{if(e==="db"){$("#spinner-db").removeClass("hide")}if(e==="pl"){$("#spinner-pl").removeClass("hide")}}}function setPlaybackSource(){if(typeof GUI.libraryhome.ActivePlayer==="undefined"){var e="MPD"}else{var e=GUI.libraryhome.ActivePlayer}$("#overlay-playsource-open button").text(e);$("#overlay-playsource a").addClass("inactive");var a=e.toLowerCase();$("#playsource-"+a).removeClass("inactive");setUIbuttons(e);$("#playlist-entries").removeClass(function(e,a){return(a.match(/(^|\s)playlist-\S+/g)||[]).join(" ")}).addClass("playlist-"+a);$("#pl-manage").removeClass(function(e,a){return(a.match(/(^|\s)pl-manage-\S+/g)||[]).join(" ")}).addClass("pl-manage-"+a)}function setUIbuttons(e){if(e==="Airplay"||e==="SpotifyConnect"||e==="Bluetooth"){$("#stop").addClass("disabled");$("#play").addClass("disabled");$("#next").addClass("hide");$("#previous").addClass("hide")}else{$("#stop").removeClass("disabled");$("#play").removeClass("disabled");if(GUI.state=="stop"){$("#previous").addClass("hide");$("#next").addClass("hide")}else{if(GUI.consume==="1"){$("#previous").addClass("hide");$("#next").removeClass("hide")}else{$("#previous").removeClass("hide");$("#next").removeClass("hide")}}if(typeof GUI.libraryhome.CDinput!=="undefined"&&typeof GUI.libraryhome.CDinput.status!=="undefined"&&Object.keys(GUI.libraryhome.CDinput.status).length){$("#eject").removeClass("hide");$("#eject").removeClass("disabled")}else{$("#eject").addClass("hide")}}if($("#section-index").length){document.getElementById("volume").readOnly=true;if(e==="Airplay"||e==="SpotifyConnect"||e==="Bluetooth"){if(GUI.local_volume_control==="0"){$("#volume-knob").addClass("disabled");$("#volume-knob").addClass("nomixer");$("#volume-knob button").prop("disabled",true);$("#volume").addClass("disabled");$("#volume-knob").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volume").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volumedn").addClass("hide");$("#volumemute").addClass("hide");$("#volumeup").addClass("hide")}else{$("#volume-knob").removeClass("disabled");$("#volume-knob").removeClass("nomixer");$("#volume-knob button").prop("disabled",false);$("#volume").removeClass("disabled");$("#volume-knob").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8","pointer-events":"auto"});$("#volume").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8","pointer-events":"auto"});$("#volumedn").removeClass("hide");$("#volumemute").removeClass("hide");$("#volumeup").removeClass("hide");$("#volumedn").removeClass("disabled");$("#volumemute").removeClass("disabled");$("#volumeup").removeClass("disabled")}$("#repeat").addClass("hide");$("#random").addClass("hide");$("#single").addClass("hide")}else{if(GUI.stream){$("#repeat").addClass("hide");$("#random").addClass("hide");$("#single").addClass("hide")}else{$("#repeat").removeClass("hide");$("#random").removeClass("hide");$("#single").removeClass("hide")}if(GUI.local_volume_control==="0"){$("#volume-knob").addClass("disabled");$("#volume-knob").addClass("nomixer");$("#volume-knob button").prop("disabled",true);$("#volume").addClass("disabled");$("#volume-knob").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volume").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F","pointer-events":"none"});$("#volumedn").addClass("hide");$("#volumemute").addClass("hide");$("#volumeup").addClass("hide")}else{$("#volume-knob").removeClass("disabled");$("#volume-knob").removeClass("nomixer");$("#volume-knob button").prop("disabled",false);$("#volume").removeClass("disabled");$("#volume-knob").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8","pointer-events":"auto"});$("#volume").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8","pointer-events":"auto"});$("#volumedn").removeClass("hide");$("#volumemute").removeClass("hide");$("#volumeup").removeClass("hide");$("#volumedn").removeClass("disabled");$("#volumemute").removeClass("disabled");$("#volumeup").removeClass("disabled")}$("#stop").removeClass("disabled");$("#play").removeClass("disabled");$("#next").removeClass("disabled")}if(e==="Bluetooth"||GUI.file.substr(0,7)==="alsa://"||GUI.file.substr(0,7)==="cdda://"){$("#overlay-social-open").addClass("hide");$("#songinfo-open").addClass("hide")}else{$("#overlay-social-open").removeClass("hide");$("#songinfo-open").removeClass("hide")}}else{GUI.activePlayer=""}}function chkKey(e){return e!==undefined&&e!==""}function renderLibraryHome(){loadingSpinner("db");$("#database-entries").addClass("hide");$("#db-level-up").addClass("hide");$("#db-homeSetup").removeClass("hide").removeClass("btn-primary").addClass("btn-default");$("#home-blocks").removeClass("hide");var e=GUI.libraryhome,a=0,s="",t='<div class="col-lg-3 col-md-4 col-sm-6">',o="</div>",i="",l=e.ActivePlayer==="Airplay"||e.ActivePlayer==="SpotifyConnect"||e.ActivePlayer==="Bluetooth";if(isLocalHost){s=""}else{s='<div class="col-sm-12"><h1 class="txtmid">Browse your library</h1></div>'}setPlaybackSource();if(l){i=" inactive"}for(a=0;bookmark=e.bookmarks[a];a+=1){s+=t+'<div id="home-bookmark-'+bookmark.id+'" class="home-block home-bookmark'+i+'" data-path="'+bookmark.path+'"><i class="fa fa-star"></i><h3>'+bookmark.name+"</h3>bookmark</div>"+o}if(chkKey(e.networkMounts)){if(isLocalHost){if(e.networkMounts===0){if(l){s+=t+'<div id="home-nas" class="home-block inactive"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3></div>'+o}else{s+=t+'<a class="home-block'+i+'" href="/sources/add/"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3></a>'+o}}else{s+=t+'<div id="home-nas" class="home-block'+i+'" data-path="NAS"><i class="fa fa-sitemap"></i><h3>Network mounts ('+e.networkMounts+")</h3></div>"+o}}else{if(e.networkMounts===0){if(l){s+=t+'<div id="home-nas" class="home-block inactive"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3>network attached storages</div>'+o}else{s+=t+'<a class="home-block'+i+'" href="/sources/add/"><i class="fa fa-sitemap"></i><h3>Network mounts (0)</h3>click to add some</a>'+o}}else{s+=t+'<div id="home-nas" class="home-block'+i+'" data-path="NAS"><i class="fa fa-sitemap"></i><h3>Network mounts ('+e.networkMounts+")</h3>network attached storages</div>"+o}}}if(chkKey(e.localStorages)){if(isLocalHost){if(e.localStorages===0){s+=""}else{s+=t+'<div id="home-local" class="home-block'+i+'" data-path="LocalStorage"><i class="fa fa-hdd-o"></i><h3>LocalStorage ('+e.localStorages+")</h3></div>"+o}}else{if(e.localStorages===0){s+=""}else{s+=t+'<div id="home-local" class="home-block'+i+'" data-path="LocalStorage"><i class="fa fa-hdd-o"></i><h3>LocalStorage ('+e.localStorages+")</h3>locally stored music</div>"+o}}}if(chkKey(e.USBMounts)){if(isLocalHost){if(e.USBMounts===0){if(l){s+=t+'<div id="home-usb" class="home-block inactive"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3></div>'+o}else{s+=t+'<a id="home-usb" class="home-block'+i+'" href="/sources"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3></a>'+o}}else{s+=t+'<div id="home-usb" class="home-block'+i+'" data-path="USB"><i class="fa fa-hdd-o"></i><h3>USB storage ('+e.USBMounts+")</h3></div>"+o}}else{if(e.USBMounts===0){if(l){s+=t+'<div id="home-usb" class="home-block inactive"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3>no USB storage plugged</div>'+o}else{s+=t+'<a id="home-usb" class="home-block'+i+'" href="/sources"><i class="fa fa-hdd-o"></i><h3>USB storage (0)</h3>no USB storage plugged</a>'+o}}else{s+=t+'<div id="home-usb" class="home-block'+i+'" data-path="USB"><i class="fa fa-hdd-o"></i><h3>USB storage ('+e.USBMounts+")</h3>USB attached drives</div>"+o}}}if(chkKey(e.webradio)){if(isLocalHost){if(e.webradio===0){if(l){s+=t+'<div id="home-webradio" class="home-block inactive"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3></div>'+o}else{s+=t+'<a id="home-webradio" class="home-block'+i+'" href="#" data-toggle="modal" data-target="#modal-webradio-add"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3></a>'+o}}else{s+=t+'<div id="home-webradio" class="home-block'+i+'" data-path="Webradio"><i class="fa fa-microphone"></i><h3>My Webradios ('+e.webradio+")</h3></div>"+o}}else{if(e.webradio===0){if(l){s+=t+'<div id="home-webradio" class="home-block inactive"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3>webradio local playlists</div>'+o}else{s+=t+'<a id="home-webradio" class="home-block'+i+'" href="#" data-toggle="modal" data-target="#modal-webradio-add"><i class="fa fa-microphone"></i><h3>My Webradios (0)</h3>click to add some</a>'+o}}else{s+=t+'<div id="home-webradio" class="home-block'+i+'" data-path="Webradio"><i class="fa fa-microphone"></i><h3>My Webradios ('+e.webradio+")</h3>webradio local playlists</div>"+o}}}if(isLocalHost){s+=t+'<div id="home-albums" class="home-block'+i+'" data-path="Albums" data-browsemode="album"><i class="fa fa-dot-circle-o"></i><h3>Albums</h3></div>'+o}else{s+=t+'<div id="home-albums" class="home-block'+i+'" data-path="Albums" data-browsemode="album"><i class="fa fa-dot-circle-o"></i><h3>Albums</h3>browse MPD database by album</div>'+o}if(isLocalHost){s+=t+'<div id="home-artists" class="home-block'+i+'" data-path="Artists" data-browsemode="artist"><i class="fa fa-users"></i><h3>Artists</h3></div>'+o}else{s+=t+'<div id="home-artists" class="home-block'+i+'" data-path="Artists" data-browsemode="artist"><i class="fa fa-users"></i><h3>Artists</h3>browse MPD database by artist</div>'+o}if(isLocalHost){s+=t+'<div id="home-composer" class="home-block'+i+'" data-path="Composer" data-browsemode="composer"><i class="fa fa-user-pen"></i><h3>Composer</h3></div>'+o}else{s+=t+'<div id="home-composer" class="home-block'+i+'" data-path="Composer" data-browsemode="composer"><i class="fa fa-user-pen"></i><h3>Composer</h3>browse MPD database by composer</div>'+o}if(isLocalHost){s+=t+'<div id="home-genre" class="home-block'+i+'" data-path="Genres" data-browsemode="genre"><i class="fa fa-tags"></i><h3>Genres</h3></div>'+o}else{s+=t+'<div id="home-genre" class="home-block'+i+'" data-path="Genres" data-browsemode="genre"><i class="fa fa-tags"></i><h3>Genres</h3>browse MPD database by genre</div>'+o}if(chkKey(e.Dirble)){if(isLocalHost){s+=t+'<div id="home-dirble" class="home-block'+i+'" data-plugin="Dirble" data-path="Dirble"><i class="fa fa-globe"></i><h3>Dirble</h3></div>'+o}else{s+=t+'<div id="home-dirble" class="home-block'+i+'" data-plugin="Dirble" data-path="Dirble"><i class="fa fa-globe"></i><h3>Dirble</h3>radio stations open directory</div>'+o}}if(chkKey(e.Jamendo)){if(isLocalHost){s+=t+'<div id="home-jamendo" class="home-block'+i+'" data-plugin="Jamendo" data-path="Jamendo"><i class="fa fa-play-circle-o"></i><h3>Jamendo<span id="home-count-jamendo"></span></h3></div>'+o}else{s+=t+'<div id="home-jamendo" class="home-block'+i+'" data-plugin="Jamendo" data-path="Jamendo"><i class="fa fa-play-circle-o"></i><h3>Jamendo<span id="home-count-jamendo"></span></h3>world\'s largest platform for free music</div>'+o}}if(chkKey(e.HWinput)){if(chkKey(GUI.libraryhome.HWinput.status)){GUI.libraryhome.HWinput.HWdevices=Object.keys(GUI.libraryhome.HWinput.status).length}else{GUI.libraryhome.HWinput.HWdevices=0}if(isLocalHost){s+=t+'<div id="home-hwinput" class="home-block'+i+'" data-plugin="HWinput" data-path="HWinput"><i class="fa fa-wave-square"></i><h3>HW Input ('+GUI.libraryhome.HWinput.HWdevices+")</h3></div>"+o}else{s+=t+'<div id="home-hwinput" class="home-block'+i+'" data-plugin="HWinput" data-path="HWinput"><i class="fa fa-wave-square"></i><h3>HW Input ('+GUI.libraryhome.HWinput.HWdevices+")</h3>browse locally connected hardware input devices</div>"+o}}if(chkKey(e.CDinput)){if(typeof GUI.libraryhome.CDinput.status!=="undefined"){GUI.libraryhome.CDinput.CDtracks=Object.keys(GUI.libraryhome.CDinput.status).length}else{GUI.libraryhome.CDinput.CDtracks=0}if(GUI.libraryhome.CDinput.CDtracks>0){GUI.libraryhome.CDinput.CDtracks--;$("#eject").removeClass("hide");$("#eject").removeClass("disabled")}else{$("#eject").addClass("hide")}if(isLocalHost){s+=t+'<div id="home-cdinput" class="home-block'+i+'" data-plugin="CDinput" data-path="CDinput"><i class="fa fa-compact-disc"></i><h3>CD-Drive ('+GUI.libraryhome.CDinput.CDtracks+")</h3></div>"+o}else{s+=t+'<div id="home-cdinput" class="home-block'+i+'" data-plugin="CDinput" data-path="CDinput"><i class="fa fa-compact-disc"></i><h3>CD-Drive ('+GUI.libraryhome.CDinput.CDtracks+")</h3>browse locally connected CD-drive</div>"+o}}s+="</div>";document.getElementById("home-blocks").innerHTML=s;loadingSpinner("db","hide");$("span","#db-currentpath").html("")}function refreshState(){if(GUI.json.state!==undefined){if(GUI.json.updating_db!==undefined){GUI.DBupdate=true}else{GUI.DBupdate=false}}if(GUI.DBupdate){$("a","#open-panel-sx").html('<i class="fa fa-refresh fa-spin"></i> Updating')}else{$("a","#open-panel-sx").html('<i class="fa fa-music sx"></i> Library')}var e=GUI.state;if(e==="play"){$("#play").addClass("btn-primary");$("i","#play").removeClass("fa fa-pause").addClass("fa fa-play");$("#stop").removeClass("btn-primary")}else if(e==="pause"){$("#playlist-position span").html("Not playing");$("#playlist-position-ss span").html("Not playing");$("#playlist-position-sss span").html("Not playing");$("#play").addClass("btn-primary");$("i","#play").removeClass("fa fa-play").addClass("fa fa-pause");$("#stop").removeClass("btn-primary")}else if(e==="stop"){$("#play").removeClass("btn-primary");$("i","#play").removeClass("fa fa-pause").addClass("fa fa-play");$("#stop").addClass("btn-primary");if($("#section-index").length){$("#countdown-display").countdown("destroy");$("#countdown-display-ss").countdown("destroy");$("#countdown-display-sss").countdown("destroy")}refreshTimer(0,0,"stop");window.clearInterval(GUI.currentKnob);if(typeof GUI.stream!="undefined"&&GUI.stream){$("#total").html("<span>&infin;</span>");$("#total-ss").html("<span>&infin;</span>");$("#total-sss").html("<span>&infin;</span>")}else{$("#total").html("00:00");$("#total-ss").html("00:00");$("#total-sss").html("00:00")}$("#time").val(0,false).trigger("update");$("#format-bitrate").html("&nbsp;");$("#format-bitrate-ss").html("&nbsp;");$("#format-bitrate-sss").html("&nbsp;");$("li","#playlist-entries").removeClass("active")}if(e!=="stop"){if(GUI.stream){$("#total").html("<span>&infin;</span>");$("#total-ss").html("<span>&infin;</span>");$("#total-sss").html("<span>&infin;</span>")}else{$("#total").html(GUI.json.time!==undefined?timeConvert(GUI.json.time):"00:00");$("#total-ss").html(GUI.json.time!==undefined?timeConvert(GUI.json.time):"00:00");$("#total-sss").html(GUI.json.time!==undefined?timeConvert(GUI.json.time):"00:00")}var a=GUI.json.audio_channels&&GUI.json.audio_sample_depth&&GUI.json.audio_sample_rate?GUI.json.audio_channels+", "+GUI.json.audio_sample_depth+"-bit, "+GUI.json.audio_sample_rate+" kHz, "+GUI.json.bitrate+" kbit/s":"&nbsp;";$("#format-bitrate").html(a);$("#format-bitrate-ss").html(a);$("#format-bitrate-sss").html(a);$("li","#playlist-entries").removeClass("active");var s=parseInt(GUI.json.song);$("#playlist-entries").find("li").eq(s).addClass("active")}if(GUI.json.playlistlength&&GUI.json.playlistlength!=="0"){if(GUI.activePlayer!==undefined&&GUI.activePlayer!="MPD"){$("#playlist-position span").html("Streaming");$("#playlist-position-ss span").html("Streaming");$("#playlist-position-sss span").html("Streaming")}else if(GUI.json.song){$("#playlist-position span").html("Queue position "+(parseInt(GUI.json.song)+1)+"/"+GUI.json.playlistlength);$("#playlist-position-ss span").html("Queue position "+(parseInt(GUI.json.song)+1)+"/"+GUI.json.playlistlength);$("#playlist-position-sss span").html("Queue position "+(parseInt(GUI.json.song)+1)+"/"+GUI.json.playlistlength)}else{$("#playlist-position span").html("Queue position 1/"+GUI.json.playlistlength);$("#playlist-position-ss span").html("Queue position 1/"+GUI.json.playlistlength);$("#playlist-position-sss span").html("Queue position 1/"+GUI.json.playlistlength)}}else{$("#playlist-position span").html("Empty queue, add some music!");$("#playlist-position-ss span").html("Empty queue, add some music!");$("#playlist-position-sss span").html("Empty queue, add some music!")}}function updateGUI(){if(typeof GUI.json.state==="undefined"||GUI.json.state===""){GUI.json.state="stop";GUI.json.song_percent=0;GUI.json.elapsed=0}if(GUI.state!==GUI.json.state){GUI.state=GUI.json.state;setPlaybackSource()}if(typeof GUI.json.time!=="undefined"){var e=GUI.json.time}if(typeof GUI.json.elapsed!=="undefined"&&GUI.state!=="stop"){refreshTimer(parseInt(GUI.json.elapsed),0,GUI.json.state)}var a=typeof GUI.json.volume=="undefined"?0:GUI.json.volume;var s=typeof GUI.json.radioname=="undefined"?"":GUI.json.radioname;var t=typeof GUI.json.currentartist=="undefined"?"":GUI.json.currentartist;var o=typeof GUI.json.currentsong=="undefined"?"":GUI.json.currentsong;var i=typeof GUI.json.currentalbum=="undefined"?"":GUI.json.currentalbum;var l=typeof GUI.json.currentalbumartist=="undefined"?"":GUI.json.currentalbumartist;var n=typeof GUI.json.currentcomposer=="undefined"?"":GUI.json.currentcomposer;var r=typeof GUI.json.mainArtURL=="undefined"?"":GUI.json.mainArtURL;var d=typeof GUI.json.smallArtURL=="undefined"?"":GUI.json.smallArtURL;var c=typeof GUI.json.bigArtURL=="undefined"?"":GUI.json.bigArtURL;var p=typeof GUI.json.coverArtPreload=="undefined"?"":GUI.json.coverArtPreload;var u=typeof GUI.json.song_lyrics=="undefined"?"":GUI.json.song_lyrics;var m=typeof GUI.json.artist_bio_summary=="undefined"?"":GUI.json.artist_bio_summary;var f=typeof GUI.json.artist_similar=="undefined"?"":GUI.json.artist_similar;var h=typeof GUI.json.actPlayer=="undefined"?"":GUI.json.actPlayer;var b=typeof GUI.json.file=="undefined"?"":GUI.json.file;var v=typeof GUI.json.local_volume_control=="undefined"?"0":GUI.json.local_volume_control;if(s!==null&&s!==undefined&&s!==""){GUI.stream="radio"}else if(b!==null&&b.substring(0,7)==="alsa://"){GUI.stream="HWinput"}else if(h!==undefined&&h==="Bluetooth"){GUI.stream="bluetooth"}else{GUI.stream=""}if(v==="0"||v===0){GUI.local_volume_control="0";if(h==="MPD"){a=100}}else if(v==="1"||v===1){GUI.local_volume_control="1"}if(typeof GUI.json.consume!=="undefined"){GUI.consume=GUI.json.consume}if(h!==GUI.activePlayer||a!==GUI.volume){GUI.activePlayer=h;setPlaybackSource()}if(typeof GUI.json.song_percent==="undefined"&&typeof GUI.json.elapsed!=="undefined"&&typeof e!=="undefined"){if(GUI.json.elapsed!=="0"&&e!=="0"){GUI.json.song_percent=parseInt(parseInt(GUI.json.elapsed)*100/parseInt(e))}else{GUI.json.song_percent="0"}}refreshState();if($("#section-index").length){if(r!==""&&GUI.mainArtURL===r&&!$("#cover-art").css("background-image").includes(r)){GUI.currentartist="";GUI.currentsong="";GUI.currentalbum="";GUI.song_lyrics="";GUI.mainArtURL="";GUI.smallArtURL="";GUI.bigArtURL="";GUI.coverArtPreload="";GUI.artist_bio_summary="";GUI.artist_similar="";GUI.file=""}if(GUI.file!==b&&GUI.state!=="stop"){GUI.file=b;countdownRestart(GUI.json.elapsed);if($("#panel-dx").hasClass("active")){var y=parseInt(GUI.json.song);customScroll("pl",y)}}if(GUI.vol_changed_local===0){$("#volume").val(a==="-1"?100:a,false).trigger("update")}if(t===""||t===null){var t='<span class="notag">[no artist]</span>'}if(GUI.currentartist!==t){GUI.currentartist=t;if(GUI.currentartist.length>55){$("#currentartist-ss")[0].style.fontSize="18px";$("#currentartist-sss")[0].style.fontSize="28px"}else if(GUI.currentartist.length>45){$("#currentartist-ss")[0].style.fontSize="20px";$("#currentartist-sss")[0].style.fontSize="30px"}else if(GUI.currentartist.length>30){$("#currentartist-ss")[0].style.fontSize="22px";$("#currentartist-sss")[0].style.fontSize="32px"}else{$("#currentartist-ss")[0].style.fontSize="28px";$("#currentartist-sss")[0].style.fontSize="34px"}$("#currentartist").html(GUI.currentartist);$("#currentartist-ss").html(GUI.currentartist);$("#currentartist-sss").html(GUI.currentartist)}if(o===""||GUI.currentsong===null){var o='<span class="notag">[no song]</span>'}if(GUI.currentsong!==o){GUI.currentsong=o;if(GUI.currentsong.length>55){$("#currentsong-ss")[0].style.fontSize="18px";$("#currentsong-sss")[0].style.fontSize="28px"}else if(GUI.currentsong.length>45){$("#currentsong-ss")[0].style.fontSize="20px";$("#currentsong-sss")[0].style.fontSize="30px"}else if(GUI.currentsong.length>35){$("#currentsong-ss")[0].style.fontSize="26px";$("#currentsong-sss")[0].style.fontSize="32px"}else if(GUI.currentsong.length>25){$("#currentsong-ss")[0].style.fontSize="32px";$("#currentsong-sss")[0].style.fontSize="36px"}else{$("#currentsong-ss")[0].style.fontSize="40px";$("#currentsong-sss")[0].style.fontSize="40px"}$("#currentsong").html(GUI.currentsong);$("#currentsong-ss").html(GUI.currentsong);$("#currentsong-sss").html(GUI.currentsong)}if(i===""||i===null){var i='<span class="notag">[no album]</span>'}if(GUI.currentalbum!==i){GUI.currentalbum=i;if(GUI.currentalbum.length>55){$("#currentalbum-ss")[0].style.fontSize="18px";$("#currentalbum-sss")[0].style.fontSize="28px"}else if(GUI.currentalbum.length>45){$("#currentalbum-ss")[0].style.fontSize="20px";$("#currentalbum-sss")[0].style.fontSize="30px"}else if(GUI.currentalbum.length>30){$("#currentalbum-ss")[0].style.fontSize="22px";$("#currentalbum-sss")[0].style.fontSize="32px"}else{$("#currentalbum-ss")[0].style.fontSize="24px";$("#currentalbum-sss")[0].style.fontSize="34px"}$("#currentalbum").html(GUI.currentalbum);$("#currentalbum-ss").html(GUI.currentalbum);$("#currentalbum-sss").html(GUI.currentalbum)}if(GUI.json.repeat==="1"){$("#repeat").addClass("btn-primary")}else{$("#repeat").removeClass("btn-primary")}if(GUI.json.random==="1"){$("#random").addClass("btn-primary")}else{$("#random").removeClass("btn-primary")}if(GUI.consume==="1"){$("#consume").addClass("btn-primary")}else{$("#consume").removeClass("btn-primary")}if(GUI.json.single==="1"){$("#single").addClass("btn-primary")}else{$("#single").removeClass("btn-primary")}if(u!==""&&GUI.song_lyrics!==u){GUI.song_lyrics=u;$("#lyric-text-overlay").html(u)}if(r!==""&&GUI.mainArtURL!==r){GUI.mainArtURL=r;$("#cover-art").css("background-image","url("+r+")");$("#cover-art-sss").css("background-image","url("+r+")")}if(d!==""&&GUI.smallArtURL!==d){GUI.smallArtURL=d;$("#artist-image-ss").css("background-image",'url("'+d+'")');$("#artist-image-overlay").css("background-image",'url("'+d+'")')}if(c!==""&&GUI.bigArtURL!==c){GUI.bigArtURL=c;$("#cover-art-ss").css("background-image",'url("'+c+'")')}if(p!==""&&GUI.coverArtPreload!==p){GUI.coverArtPreload=p;$("#cover-art-preload").css("background-image",'url("'+p+'")')}if(m!==""&&GUI.artist_bio_summary!==m){GUI.artist_bio_summary=m;$("#artist-bio-ss").html(m);$("#artist-bio-overlay").html(m)}if(f!==""&&GUI.artist_similar!==f){GUI.artist_similar=f;$("#addinfo-text-ss").html(f);$("#addinfo-text-overlay").html(f)}}}function getPlaylistPlain(e){var a=parseInt(GUI.json.song)+1;var s=GUI.state;var t="",o="",i="",l="",n="",r="",d="",c="",p="",u=0,m="",f="",h=0,b=0,v=0;var y,g,I=e.split("\n"),C=[];for(y=0;g=I[y];y+=1){C=g.split(/: (.+)?/);if("Time"===C[0]){o=parseInt(C[1])}else if("Artist"===C[0]){i=C[1]}else if("Title"===C[0]){n=C[1]}else if("Name"===C[0]){r=C[1]}else if("Album"===C[0]){l=C[1]}else if("file"===C[0]){d=C[1]}else if("Id"===C[0]){m=C[1];if(n===""){c=d.split("/").pop();if(d.substring(0,7)==="cdda://"){n='<i class="fa fa-compact-disc"></i> CD Track #'+c;if(typeof GUI.libraryhome.CDinput.status[c]!="undefined"&&GUI.libraryhome.CDinput.status[c].time){o=GUI.libraryhome.CDinput.status[c].time}}else if(d.substring(0,7)==="alsa://"){if(typeof GUI.libraryhome.HWinput.status[d]!=="undefined"&&GUI.libraryhome.HWinput.status[d].name){n='<i class="fa fa-wave-square"></i> Hardware input: '+GUI.libraryhome.HWinput.status[d].name+" - "+GUI.libraryhome.HWinput.status[d].sysname;i=GUI.libraryhome.HWinput.status[d].description;l=d}else{n='<i class="fa fa-wave-square"></i> Hardware input: '+d}}else{n=c}}if(d.substring(0,4).toLowerCase()==="http"&&i===""&&l===""&&r===""){r=n}if(i===""||l===""){p=parsePath(d);if(i===""){f="path: "+p}else{f=i}}else{f=i+" - "+l}if(r!==""){if(r!==n&&n!==""){n='<i class="fa fa-microphone"></i>'+r+" : "+n}else{n='<i class="fa fa-microphone"></i>'+r}f="URL: "+d;h=""}else if(typeof o==="undefined"||!o){h=""}else{h="<span>"+timeConvert2(o)+"</span>";b+=o}v++;t+='<li id="pl-'+m+'"'+(s!=="stop"&&v===a?' class="active"':"")+'><i class="fa fa-times-circle pl-action" title="Remove song from playlist"></i><span class="sn">'+n+h+'</span><span class="bl">'+f+"</span></li>";o="";i="";l="";n="";r=""}}$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");var U=document.getElementById("playlist-entries");if(U){U.innerHTML=t}$("#pl-filter-results").addClass("hide").html("");$("#pl-filter").val("");$("#pl-manage").removeClass("hide");$("#pl-count").removeClass("hide").html(v+(v!==1?" entries":" entry")+" "+timeConvert3(b)+" total playtime")}function getPlaylistCmd(){loadingSpinner("pl");$.ajax({url:"/db/?cmd=playlist",success:function(e){if(e.length>4){$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");getPlaylistPlain(e);var a=parseInt(GUI.json.song);if($("#panel-dx").hasClass("active")&&GUI.currentsong!==GUI.json.currentsong){customScroll("pl",a,200)}}else{$(".playlist").addClass("hide");$("#playlist-warning").removeClass("hide");$("#pl-filter-results").addClass("hide").html("");$("#pl-count").removeClass("hide").html("0 entries")}loadingSpinner("pl","hide")},cache:false})}function getPlaylist(e){data=e[0];if(data.length>4){$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");getPlaylistPlain(data);var a=parseInt(GUI.json.song);if($("#panel-dx").hasClass("active")&&GUI.currentsong!==GUI.json.currentsong){customScroll("pl",a,200)}}else{$(".playlist").addClass("hide");$("#playlist-warning").removeClass("hide");$("#pl-filter-results").addClass("hide").html("");$("#pl-count").removeClass("hide").html("0 entries")}loadingSpinner("pl","hide")}function renderUI(e){toggleLoader("close");GUI.json=e[0];updateGUI();if($("#section-index").length){if(GUI.state!=="stop"&&GUI.json.elapsed!=="undefined"&&typeof GUI.json.song_percent!=="undefined"){refreshKnob()}if(GUI.json.playlist!==GUI.playlist){getPlaylistCmd();GUI.playlist=GUI.json.playlist}}checkPlayerState()}function renderPlaylists(e){var a="",s="",t=false;var o,i,l=e.split("\n"),n=[];l.sort(function(e,a){return e.toLowerCase().localeCompare(a.toLowerCase())});for(o=0;o<l.length;o++){n=l[o].split(": ");if("playlist"===n[0]){s=n[1];a+='<li class="pl-folder" data-path="'+s+'"><i class="fa fa-bars pl-action" data-target="#context-menu-playlist" data-toggle="context" title="Actions"></i><span><i class="fa fa-list-ol"></i>'+s+"</span></li>";s="";t=true}}document.getElementById("playlist-entries").innerHTML="";$(".playlist").addClass("hide");$("#pl-manage").addClass("hide");$("#pl-count").addClass("hide");if(t){$("#pl-filter-results").removeClass("hide").addClass("back-to-queue").html('<i class="fa fa-arrow-left sx"></i> Back to queue')}else{$("#pl-filter-results").removeClass("hide").addClass("back-to-queue").html('<i class="fa fa-arrow-left sx"></i> No playlists found, return to queue')}$("#pl-currentpath").removeClass("hide");$("#pl-editor").removeClass("hide");document.getElementById("pl-editor").innerHTML=a;loadingSpinner("pl","hide")}function getPlaylists(){loadingSpinner("pl");$.ajax({url:"/command/?cmd=listplaylists",success:function(e){renderPlaylists(e)},cache:false})}function updatePlaylistDropdown(e){var a,s,t=e.split("\n"),o=[];var i="";for(a=0;s=t[a];a+=1){o=s.split(": ");if("playlist"===o[0]){i+='<option value="'+o[1]+'" />'}}document.getElementById("pl-list").innerHTML=i;loadingSpinner("pl","hide")}function getPlaylistsDropdown(){loadingSpinner("pl");$.ajax({url:"/command/?cmd=listplaylists",success:function(e){updatePlaylistDropdown(e)},cache:false})}function parseResponse(e){var a=e.inputArr||"",s=e.respType||"",t=e.i||0,o=e.inpath||"",i=e.querytype||"",l="";switch(s){case"playlist":break;case"db":if(GUI.browsemode==="file"){if(o===""&&a.file!==undefined){o=parsePath(a.file)}if(a.file!==undefined||o==="Webradio"){l='<li id="db-'+(t+1)+'" data-path="';if(a.fileext===undefined){if(a.file!==undefined){a.fileext=a.file.split(".").pop().toLowerCase()}else{a.fileext=""}}else{a.fileext=a.fileext.toLowerCase()}if(a.Title!==undefined){l+=a.file;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';l+=a.Title+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";l+=' <span class="bl">';l+=a.Artist;l+=" - ";l+=a.Album}else{if(o!=="Webradio"){l+=a.file;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';l+=a.file.replace(o+"/","")+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";l+='<span class="bl">';l+=" path: ";l+=o}else{l+=a.playlist;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-webradio"></i><i class="fa fa-microphone db-icon db-radio"></i>';l+='<span class="sn">'+a.playlist.replace(o+"/","").replace("."+a.fileext,"");l+='</span><span class="bl">webradio'}}l+="</span></li>"}else if(a.playlist!==undefined){if(a.fileext==="cue"){l='<li id="db-'+(t+1)+'" data-path="';l+=a.playlist;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-file-text db-icon"></i><span class="sn">';l+=a.playlist.replace(o+"/","")+" <span>[CUE file]</span></span>";l+='<span class="bl">';l+=" path: ";l+=o;l+="</span></li>"}}else{l='<li id="db-'+(t+1)+'" class="db-folder" data-path="';l+=a.directory;if(o!==""){l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu"></i><span><i class="fa fa-folder-open"></i>'}else{l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-root"></i><i class="fa fa-hdd-o icon-root"></i><span>'}l+=a.directory.replace(htmlEncode(o)+"/","");l+="</span></li>"}}else if(GUI.browsemode==="album"||GUI.browsemode==="albumfilter"){if(a.file!==undefined){l='<li id="db-'+(t+1)+'" data-path="';l+=a.file;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';l+=a.Title+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";l+=' <span class="bl">';l+=a.Artist;l+=" - ";l+=a.Album;l+="</span></li>"}else if(a.album!==""){l='<li id="db-'+(t+1)+'" class="db-folder db-album" data-path="';l+=a.album.replace(/\"/g,"&quot;");l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-album"></i><span><i class="fa fa-dot-circle-o"></i>';l+=a.album;l+="</span></li>"}}else if(GUI.browsemode==="artist"){if(a.album!==undefined){l='<li id="db-'+(t+1)+'" class="db-folder db-album" data-path="';l+=a.album;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-album"></i><span><i class="fa fa-dot-circle-o"></i>';l+=a.album!==""?a.album:"Unknown album";l+="</span></li>"}else if(a.artist!==""){l='<li id="db-'+(t+1)+'" class="db-folder db-artist" data-path="';l+=a.artist;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-artist"></i><span><i class="fa fa-user"></i>';l+=a.artist;l+="</span></li>"}}else if(GUI.browsemode==="composer"){if(a.file!==undefined){l='<li id="db-'+(t+1)+'" data-path="';l+=a.file;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i><i class="fa fa-music db-icon"></i><span class="sn">';l+=a.Title+" <span>"+timeConvert(a.Time)+" <span>"+a.fileext+"</span></span>";l+=' <span class="bl">';l+=a.Artist;l+=" - ";l+=a.Album;l+="</span></li>"}else if(a.composer!==""){l='<li id="db-'+(t+1)+'" class="db-folder db-composer" data-path="';l+=a.composer;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-composer"></i><span><i class="fa fa-user"></i>';l+=a.composer;l+="</span></li>"}}else if(GUI.browsemode==="genre"){if(a.artist!==undefined){l='<li id="db-'+(t+1)+'" class="db-folder db-artist" data-path="';l+=a.artist;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-artist"></i><span><i class="fa fa-dot-circle-o"></i>';l+=a.artist!==""?a.artist:"Unknown artist";l+="</span></li>"}else if(a.genre!==""){l='<li id="db-'+(t+1)+'" class="db-folder db-genre" data-path="';l+=a.genre;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-genre"></i><span><i class="fa fa-tags"></i>';l+=a.genre;l+="</span></li>"}}break;case"CDinput":l='<li id="db-'+(t+1)+'" data-path="';l+=a.file;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-hw"></i><i class="fa fa-compact-disc db-icon"></i><span class="sn">';l+=a.name+" <span>"+timeConvert(a.time)+"</span>";l+='<span class="bl">';l+=a.file;l+="</span></li>";break;case"HWinput":l='<li id="db-'+(t+1)+'" data-path="';l+=a.file;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-hw"></i><i class="fa fa-wave-square db-icon"></i><span class="sn">';l+=a.name+" <span>"+a.sysname+a.note+"</span>";l+='<span class="bl">';l+=a.file+" - "+a.description;l+="</span></li>";break;case"Dirble":if(i===""||i==="childs"){var n=i==="childs"?" db-dirble-child":"";l='<li id="db-'+(t+1)+'" class="db-dirble db-folder'+n+'" data-path="';l+=a.id;l+='"><span><i class="fa fa-folder-open"></i>';l+=a.title;l+="</span></li>"}else if(i==="search"||i==="stations"||i==="childs-stations"){if(a.streams.length===0){break}l='<li id="db-'+(t+1)+'" class="db-dirble db-radio" data-path="';l+=a.name+" | "+a.streams[0].stream;l+='"><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-dirble"></i><i class="fa fa-microphone db-icon"></i>';l+='<span class="sn">'+a.name+"<span>("+a.country+")</span></span>";l+='<span class="bl">';l+=a.website?a.website:"-no website-";l+="</span></li>"}break;case"Jamendo":l='<li id="db-'+(t+1)+'" class="db-jamendo db-folder" data-path="';l+=a.stream;l+='"><img class="jamendo-cover" src="/tun/'+a.image+'" alt=""><i class="fa fa-bars db-action" title="Actions" data-toggle="context" data-target="#context-menu-file"></i>';l+=a.dispname+"</div></li>";break}return l}function populateDB(e){var a=e.data||"",s=e.path||"",t=e.uplevel||0,o=e.keyword||"",i=e.plugin||"",l=e.querytype||"",n=e.args||"",r="",d=0,c=[];if(i!==""){if(i==="CDinput"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").addClass("hide");if(s){if(l==="search"){GUI.currentpath="CDinput"}else{GUI.currentpath=s}}r="<legend>&nbsp;CD Input";if(typeof GUI.libraryhome.CDinput.model!="undefined"&&GUI.libraryhome.CDinput.model){r+=" - "+GUI.libraryhome.CDinput.model+" ("+GUI.libraryhome.CDinput.device+")"}if(typeof GUI.libraryhome.CDinput.error!="undefined"&&GUI.libraryhome.CDinput.error){r+="<br><i>&nbsp;"+GUI.libraryhome.CDinput.error+"</i>"}r+="</legend>";if(typeof GUI.libraryhome.CDinput.status!=="undefined"&&Object.keys(GUI.libraryhome.CDinput.status).length){for(d=0;c=GUI.libraryhome.CDinput.status[d];d+=1){r+=parseResponse({inputArr:c,respType:"CDinput",i:d,querytype:l})}}document.getElementById("database-entries").innerHTML=r}if(i==="HWinput"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").addClass("hide");if(s){if(l==="search"){GUI.currentpath="HWinput"}else{GUI.currentpath=s}}r="<legend>&nbsp;Hardware Input";if(typeof GUI.libraryhome.HWinput.format!="undefined"&&GUI.libraryhome.HWinput.format){r+="<br>&nbsp;Predefined format: "+GUI.libraryhome.HWinput.format}if(typeof GUI.libraryhome.HWinput.error!="undefined"&&GUI.libraryhome.HWinput.error){r+="<br><i>&nbsp;"+GUI.libraryhome.HWinput.error+"</i>"}r+="</legend>";if(typeof GUI.libraryhome.HWinput.status!="undefined"&&Object.keys(GUI.libraryhome.HWinput.status).length){for(var p in GUI.libraryhome.HWinput.status){c=GUI.libraryhome.HWinput.status[p];r+=parseResponse({inputArr:c,respType:"HWinput",i:d,querytype:l})}}document.getElementById("database-entries").innerHTML=r}if(i==="Dirble"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").removeClass("hide");if(s){if(l==="search"){GUI.currentpath="Dirble"}else{GUI.currentpath=s}}if(l==="childs-stations"){r=document.getElementById("database-entries").innerHTML}else{document.getElementById("database-entries").innerHTML=""}a.sort(function(e,a){if(l===""||l==="childs"||l==="categories"){nameA=e.hasOwnProperty("title")?e.title.toLowerCase():"";nameB=a.hasOwnProperty("title")?a.title.toLowerCase():""}else if(l==="childs-stations"||l==="stations"){nameA=e.hasOwnProperty("name")?e.name.toLowerCase():"";nameB=a.hasOwnProperty("name")?a.name.toLowerCase():""}else{return 0}return nameA.localeCompare(nameB)});for(d=0;c=a[d];d+=1){r+=parseResponse({inputArr:c,respType:"Dirble",i:d,querytype:l})}document.getElementById("database-entries").innerHTML=r}if(i==="Jamendo"){$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").removeClass("hide");if(s){GUI.currentpath=s}document.getElementById("database-entries").innerHTML="";a.sort(function(e,a){if(s==="Jamendo"&&l===""){nameA=e.hasOwnProperty("dispname")?e.dispname.toLowerCase():"";nameB=a.hasOwnProperty("dispname")?a.dispname.toLowerCase():""}else{return 0}return nameA.localeCompare(nameB)});for(d=0;c=a[d];d+=1){r+=parseResponse({inputArr:c,respType:"Jamendo",i:d,querytype:l})}document.getElementById("database-entries").innerHTML=r}}else{if(s===""&&o===""){renderLibraryHome();return}else{$("#database-entries").removeClass("hide");$("#db-level-up").removeClass("hide");$("#home-blocks").addClass("hide");$("#db-search").removeClass("hide");if(s){GUI.currentpath=s}document.getElementById("database-entries").innerHTML="";if(o!==""){var u=a.length?a.length:"0";var m=a.length===1?"":"s";$("#db-level-up").addClass("hide");$("#db-search-results").removeClass("hide").html('<i class="fa fa-times sx"></i><span class="visible-xs-inline">back</span><span class="hidden-xs">'+u+" result"+m+' for "<span class="keyword">'+o+'</span>"</span>')}a.sort(function(e,a){if(s==="Artists"||s==="AlbumArtists"||s==="Various Artists"){nameA=e.hasOwnProperty("artist")?e.artist.toLowerCase():"";nameB=a.hasOwnProperty("artist")?a.artist.toLowerCase():""}else if(s==="Albums"){nameA=e.hasOwnProperty("album")?e.album.toLowerCase():"";nameB=a.hasOwnProperty("album")?a.album.toLowerCase():""}else if(s==="Webradio"){nameA=e.hasOwnProperty("playlist")?e.playlist.toLowerCase():"";nameB=a.hasOwnProperty("playlist")?a.playlist.toLowerCase():""}else if(s==="Genres"){nameA=e.hasOwnProperty("genre")?e.genre.toLowerCase():"";nameB=a.hasOwnProperty("genre")?a.genre.toLowerCase():""}else if(s){nameA=e.hasOwnProperty("directory")?e.directory.toLowerCase():"";nameB=a.hasOwnProperty("directory")?a.directory.toLowerCase():""}else{return 0}return nameA.localeCompare(nameB)});if(s==="Webradio"){r+='<li id="webradio-add" class="db-webradio-add"><i class="fa fa-plus-circle db-icon"></i><span class="sn"><em>add new</em></span><span class="bl">add a webradio to your library</span></li>'}for(d=0;c=a[d];d+=1){r+=parseResponse({inputArr:c,respType:"db",i:d,inpath:s})}document.getElementById("database-entries").innerHTML=r}}var f=$("span","#db-currentpath");if(GUI.browsemode==="album"){if(s==="Albums"){f.html(s)}else{f.html("Albums/"+s)}}else if(GUI.browsemode==="artist"){if(s==="Artists"){f.html(s)}else{f.html("Artists/"+s)}}else if(GUI.browsemode==="composer"){if(s==="Composer"){f.html(s)}else{f.html("Composer/"+s)}}else if(GUI.browsemode==="genre"){if(s==="Genres"){f.html(s)}else{f.html("Genres/"+s)}}else{f.html(s)}$("#db-homeSetup").addClass("hide");if(t){var h=GUI.currentDBpos[GUI.currentDBpos[10]];$("#db-"+h).addClass("active");customScroll("db",h,0)}else{customScroll("db",0,0)}if(l!="childs"){loadingSpinner("db","hide")}}function getDB(e){var a=e.cmd||"browse",s=e.path||"",t=e.browsemode||"file",o=e.uplevel||"",i=e.plugin||"",l=e.querytype||"",n=e.args||"";loadingSpinner("db");GUI.browsemode=t;if(i!==""){if(i==="Dirble"){if(l==="childs"){$.post("/db/?cmd=dirble",{querytype:"childs",args:n},function(e){populateDB({data:e,path:s,plugin:i,querytype:"childs",uplevel:o})},"json");$.post("/db/?cmd=dirble",{querytype:"childs-stations",args:n},function(e){populateDB({data:e,path:s,plugin:i,querytype:"childs-stations",uplevel:o})},"json")}else{$.post("/db/?cmd=dirble",{querytype:l===""?"categories":l,args:n},function(e){populateDB({data:e,path:s,plugin:i,querytype:l,uplevel:o})},"json")}}else if(i==="CDinput"){populateDB({data:0,path:s,plugin:i,querytype:l})}else if(i==="HWinput"){populateDB({data:0,path:s,plugin:i,querytype:l})}else if(i==="Jamendo"){$.post("/db/?cmd=jamendo",{querytype:l===""?"radio":l,args:n},function(e){populateDB({data:e.results,path:s,plugin:i,querytype:l})},"json")}}else{if(a==="search"){var r=$("#db-search-keyword").val();if(s.match(/Dirble/)){$.post("/db/?cmd=dirble",{querytype:"search",args:r},function(e){populateDB({data:e,path:s,plugin:"Dirble",querytype:"search",uplevel:o})},"json")}else{$.post("/db/?querytype="+GUI.browsemode+"&cmd=search",{query:r},function(e){populateDB({data:e,path:s,uplevel:o,keyword:r})},"json")}}else if(a==="browse"){$.post("/db/?cmd=browse",{path:s,browsemode:GUI.browsemode},function(e){populateDB({data:e,path:s,uplevel:o})},"json")}else{loadingSpinner("db","hide");$.post("/db/?cmd="+a,{path:s,querytype:l},function(e){},"json")}}}function onreleaseKnob(e){if(GUI.state!=="stop"&&GUI.state!==""){if(!GUI.stream){window.clearInterval(GUI.currentKnob);var a=Math.floor(e*parseInt(GUI.json.time)/1e3);sendCmd("seek "+GUI.json.song+" "+a);$("#time").val(e);$("#countdown-display").countdown("destroy");$("#countdown-display-ss").countdown("destroy");$("#countdown-display-sss").countdown("destroy");$("#countdown-display").countdown({since:-a,compact:true,format:"MS"});$("#countdown-display-ss").countdown({since:-a,compact:true,format:"MS"});$("#countdown-display-sss").countdown({since:-a,compact:true,format:"MS"})}}}function commandButton(e){var a=e.data("cmd");var s;if(a==="stop"){e.addClass("btn-primary");$("#play").removeClass("btn-primary");if($("#section-index").length){refreshTimer(0,0,"stop");window.clearInterval(GUI.currentKnob);$(".playlist").find("li").removeClass("active");$("#total").html("00:00");$("#total-ss").html("00:00");$("#total-sss").html("00:00")}}else if(a==="play"){var t=GUI.state;if(t==="play"){s="pause";if($("#section-index").length){$("#countdown-display").countdown("pause");$("#countdown-display-ss").countdown("pause");$("#countdown-display-sss").countdown("pause")}}else if(t==="pause"){s="play";if($("#section-index").length){$("#countdown-display").countdown("resume");$("#countdown-display-ss").countdown("resume");$("#countdown-display-sss").countdown("resume")}}else if(t==="stop"){s="play";if($("#section-index").length){$("#countdown-display").countdown({since:0,compact:true,format:"MS"});$("#countdown-display-ss").countdown({since:0,compact:true,format:"MS"});$("#countdown-display-sss").countdown({since:0,compact:true,format:"MS"})}}window.clearInterval(GUI.currentKnob);sendCmd(s);return}else if(a==="previous"||a==="next"){if($("#section-index").length){$("#countdown-display").countdown("pause");$("#countdown-display-ss").countdown("pause");$("#countdown-display-sss").countdown("pause");window.clearInterval(GUI.currentKnob)}}else if(e.hasClass("btn-volume")){var o;var i=parseInt($("#volume").val());if(typeof GUI.volume!=="number"){GUI.volume=i}GUI.volume=parseInt(GUI.volume);if(a==="volumedn"){o=Math.max(GUI.volume-1,0);GUI.volume=o;$("#volumemute").removeClass("btn-primary")}else if(a==="volumeup"){o=Math.min(GUI.volume+1,100);GUI.volume=o;$("#volumemute").removeClass("btn-primary")}else if(a==="volumemute"){if(i!==0){GUI.volume=i;e.addClass("btn-primary");o=0}else{e.removeClass("btn-primary");o=GUI.volume}}if(o>=0&&o<=100){sendCmd("setvol "+o);$("#volume").val(o,false).trigger("update")}return}if(e.hasClass("btn-toggle")){s=a+(e.hasClass("btn-primary")?" 0":" 1");e.toggleClass("btn-primary")}else{s=a}sendCmd(s)}function libraryHome(e){GUI.libraryhome=e[0];if(GUI.libraryhome.clientUUID===GUI.clientUUID&&GUI.plugin!=="Dirble"&&GUI.currentpath!=="Webradio"){renderLibraryHome()}if(GUI.currentpath==="Webradio"){getDB({path:"Webradio",uplevel:0})}if(GUI.forceGUIupdate===true){GUI.forceGUIupdate=false;renderLibraryHome()}if(typeof GUI.libraryhome.CDinput!=="undefined"&&typeof GUI.libraryhome.CDinput.status!=="undefined"&&Object.keys(GUI.libraryhome.CDinput.status).length){$("#eject").removeClass("hide");$("#eject").removeClass("disabled")}else{$("#eject").addClass("hide")}}function renderModal(e){toggleLoader("close");if(typeof isLocalHost==="undefined"||!isLocalHost){var a=e[0];if(typeof a.clientUUID==="undefined"||a.clientUUID===GUI.clientUUID){if(a.id==="modal-display-text"){if(typeof a.header!=="undefined"){$("#modal-display-text-title").html(a.header)}else{$("#modal-display-text-title").html("")}if(typeof a.text!=="undefined"){$("#modal-display-text-text").html(a.text)}else{$("#modal-display-text-text").html("")}}$("#"+a.id).on("hidden.bs.modal",function(){$(this).find("input").val("")});$("#"+a.id).modal()}}}function playbackChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode,reconnectOnChannelUnavailableInterval:5e3});e.onmessage=renderUI;e.onstatuschange=function(e){if(e===2){$("#loader").addClass("hide");sendCmd("renderui")}else{if(e===0){toggleLoader()}}};e.addChannel("playback");e.connect()}function queueChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=getPlaylist;e.addChannel("queue");e.connect()}function libraryChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=libraryHome;e.addChannel("library");e.connect()}function notifyChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=renderMSG;e.addChannel("notify");e.connect()}function modalChannel(){var e=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});e.onmessage=renderModal;e.addChannel("modal");e.connect()}function overlayTrigger(o){var i=$(o),e=$(o+"-open"),a=$(o+"-close");transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};function toggleOverlay(){if(i.hasClass("open")){i.removeClass("open");i.addClass("closed");var a=function(e){if(support.transitions){if(e.propertyName!=="visibility"){return}this.removeEventListener(transEndEventName,a)}i.removeClass("closed")}}else if(i.hasClass("closed")){i.addClass("open");if(o==="#overlay-social"){var e="https://twitter.com/home?status=Listening+to+"+GUI.json.currentsong.replace(/\s+/g,"+")+"+by+"+GUI.json.currentartist.replace(/\s+/g,"+")+"+on+%40RuneAudio+http%3A%2F%2Fwww.runeaudio.com%2F+%23nowplaying";var s="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.runeaudio.com%2F&display=popup";var t="https://plus.google.com/share?url=http%3A%2F%2Fwww.runeaudio.com%2F";$("#urlTwitter").attr("href",e);$("#urlFacebook").attr("href",s);$("#urlGooglePlus").attr("href",t)}}}e.click(function(){toggleOverlay()});a.click(function(){toggleOverlay()})}function getHiddenProp(){var e=["webkit","moz","ms","o"];if("hidden"in document){return"hidden"}for(var a=0;a<e.length;a++){if(e[a]+"Hidden"in document){return e[a]+"Hidden"}}return null}function isHidden(){var e=getHiddenProp();if(!e){return false}return document[e]}function visChange(){if(isHidden()){GUI.visibility="hidden"}else{GUI.visibility="visible"}}if($("#section-index").length){jQuery(document).ready(function(l){"use strict";GUI.mode=checkWebSocket();playbackChannel();libraryChannel();modalChannel();PNotify.prototype.options.styling="fontawesome";PNotify.prototype.options.stack.dir1="up";PNotify.prototype.options.stack.dir2="left";PNotify.prototype.options.stack.firstpos1=90;PNotify.prototype.options.stack.firstpos2=50;PNotify.prototype.options.stack.spacing1=10;PNotify.prototype.options.stack.spacing2=10;notifyChannel();var e=getHiddenProp();if(e){var a=e.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(a,visChange)}l(window).ready(function(){updateGUI()});l(".btn-cmd").click(function(){var e=l(this);commandButton(e)});l("#eject").click(function(){l("#eject").addClass("disabled");l.post("/db/?cmd=eject","")});var s;var t;l("#volumedn").on("mouseleave mouseout mouseup",function(){clearInterval(s);return false});l("#volumedn").mousedown(function(){t=300;s=setInterval(vol_down_interval,t+200);return false});function vol_down_interval(){clearInterval(s);t=t-10;if(t<50){t=50}s=setInterval(vol_down_interval,t);var e;var a=parseInt(l("#volume").val());if(parseInt(GUI.volume)>0){e=parseInt(GUI.volume)-1;GUI.volume=e;l("#volumemute").removeClass("btn-primary")}if(e>=0&&e<=100){setvol(e);l("#volume").val(e,false).trigger("update")}}l("#volumeup").on("mouseleave mouseout mouseup",function(){clearInterval(s);return false});l("#volumeup").mousedown(function(){t=300;s=setInterval(vol_up_interval,t+200);return false});function vol_up_interval(){clearInterval(s);t=t-10;if(t<50){t=50}s=setInterval(vol_up_interval,t);var e;var a=parseInt(l("#volume").val());if(parseInt(GUI.volume)<100){e=parseInt(GUI.volume)+1;GUI.volume=e;l("#volumemute").removeClass("btn-primary")}if(e>=0&&e<=100){setvol(e);l("#volume").val(e,false).trigger("update")}}l("#volume").click(function(){l("#volumemute").click()});l("#countdown-display").click(function(){sendCmd("pause")});l("#total").click(function(){sendCmd("pause")});l("#random").click(function(){l("#random").attr("data-cmd","random");l("#random").attr("title","Random");l("#random").removeClass("btn-primary")});l("#panel-sx").click(function(){addPlayerScrollbars()});l("#panel-dx").click(function(){addPlayerScrollbars()});l("button#songinfo-open").click(function(){addPlayerScrollbars()});l("#playback").click(function(){removePlayerScrollbars()});l("button#songinfo-close-x").click(function(){removePlayerScrollbars()});l("button#songinfo-close-cancel").click(function(){removePlayerScrollbars()});l("#time").knob({inline:false,change:function(e){if(GUI.state!=="stop"){window.clearInterval(GUI.currentKnob)}else{l("#time").val(0).trigger("change")}},release:function(e){onreleaseKnob(e)}});var o=l("#volume").data("dynamic");l("#volume").knob({inline:false,change:function(e){var a=parseInt(e);if(a>GUI.maxvol-4&&GUI.checkvol<GUI.minvol+5){l("#volume").val(0);if(o){l(document).mouseup()}return false}else if(a<GUI.minvol+4&&GUI.checkvol>GUI.maxvol-5){l("#volume").val(100);if(o){l(document).mouseup()}return false}if(o&&a!==GUI.volume){setvol(a)}GUI.checkvol=a},release:function(e){var a=parseInt(e);if(!o&&a!==GUI.volume){setvol(a)}},draw:function(){if(this.$.data("skin")==="tron"){this.cursorExt=.05;var e=this.arc(this.cv),a,s=1;this.g.lineWidth=this.lineWidth;if(this.o.displayPrevious){a=this.arc(this.v);this.g.beginPath();this.g.strokeStyle=this.pColor;this.g.arc(this.xy,this.xy,this.radius-this.lineWidth,a.s,a.e,a.d);this.g.stroke()}this.g.beginPath();this.g.strokeStyle=s?this.o.fgColor:this.fgColor;this.g.arc(this.xy,this.xy,this.radius-this.lineWidth,e.s,e.e,e.d);this.g.stroke();this.g.lineWidth=2;this.g.beginPath();this.g.strokeStyle=this.o.fgColor;this.g.arc(this.xy,this.xy,this.radius-this.lineWidth+this.radius/5+this.lineWidth*2/3,0,2*Math.PI,false);this.g.stroke();return false}}});var i=l("#playlist-entries");i.on("click","li",function(e){var a="";if(l(e.target).hasClass("pl-action")){e.preventDefault();var s=l(this).attr("id");s=parseInt(s.replace("pl-",""));a="deleteid "+s;sendCmd(a)}else{var t=l("li","#playlist-entries").index(this);a="play "+t;sendCmd(a);l("li.active","#playlist-entries").removeClass("active");l(this).addClass("active")}});l("a","#open-panel-dx").click(function(){if(l("#open-panel-dx").hasClass("active")){var e=parseInt(GUI.json.song);customScroll("pl",e,500);if(!l("#pl-filter-results").hasClass("hide"))l("#pl-filter-results").click()}}).on("shown.bs.tab",function(e){var a=parseInt(GUI.json.song);customScroll("pl",a,0)});l("#open-library").click(function(){l("#open-panel-dx").removeClass("active");l("#open-panel-sx").addClass("active")});l("#pl-filter").keyup(function(){l.scrollTo(0,500);var a=l(this).val(),s=0;l("li","#playlist-entries").each(function(){var e=l(this);if(e.text().search(new RegExp(a,"i"))<0){e.hide()}else{e.show();s++}});var e=s;var t=s===1?"":"s";if(a!==""){l("#pl-count").addClass("hide");l("#pl-filter-results").removeClass("hide").html('<i class="fa fa-times sx"></i><span class="visible-xs-inline">back</span><span class="hidden-xs">'+ +s+" result"+t+' for "<span class="keyword">'+a+'</span>"</span>')}else{l("#pl-count").removeClass("hide");l("#pl-filter-results").addClass("hide").html("")}});l("#pl-filter-results").click(function(){l(this).addClass("hide");l("#pl-count").removeClass("hide");if(l(this).hasClass("back-to-queue")){l(".playlist").addClass("hide");getPlaylistCmd();l("#pl-currentpath").addClass("hide");l("#pl-manage").removeClass("hide")}else{l("li","#playlist-entries").each(function(){var e=l(this);e.show()});l("#pl-currentpath").removeClass("hide");l("#pl-filter").val("")}customScroll("pl",parseInt(GUI.json.song),500)});l("#pl-manage-list").click(function(){getPlaylists()});l("#modal-pl-save-btn").click(function(){var e=l("#pl-save-name").val();l.post("/db/?cmd=pl-save",{playlist:e})});l("#pl-editor").on("click",".pl-action",function(e){e.preventDefault();var a=l(this).parent().attr("data-path");GUI.DBentry[0]=a});l("#pl-rename-button").click(function(){var e=l("#pl-rename-oldname").text();var a=l("#pl-rename-name").val();l.post("/db/?cmd=pl-rename",{oldname:e,newname:a},function(){getPlaylists()})});l("#pl-ashuffle-start-button").click(function(){l.post("/db/?cmd=pl-ashuffle-start","")});l("#pl-ashuffle-stop-button").click(function(){l.post("/db/?cmd=pl-ashuffle-stop","")});l("#pl-ashuffle-reset-button").click(function(){l.post("/db/?cmd=pl-ashuffle-reset","")});l("#pl-clear-played-button").click(function(){l.post("/db/?cmd=pl-clear-played","");l.scrollTo(0,500)});l("#pl-crop-button").click(function(){l.post("/db/?cmd=pl-crop","");l.scrollTo(0,500)});l("#pl-manage-save").click(function(){getPlaylistsDropdown()});var n=document.getElementById("playlist-entries");new Sortable(n,{ghostClass:"sortable-ghost",onUpdate:function(e){sortOrder(e.item.getAttribute("id"))}});l("a","#open-panel-sx").click(function(){if(l("#open-panel-sx").hasClass("active")){customScroll("pl",parseInt(GUI.json.song),500)}}).on("shown.bs.tab",function(e){customScroll("db",GUI.currentDBpos[GUI.currentDBpos[10]],0)});l("#home-blocks").on("click",".home-block",function(e){if(!l(this).hasClass("inactive")){if(l(e.target).is("span.block-remove")){var a=l(this).attr("id");a=a.replace("home-bookmark-","");var s=l(this).find("h3").text();l.post("/db/?cmd=bookmark",{id:a,name:s})}else{++GUI.currentDBpos[10];getDB({browsemode:l(this).data("browsemode"),path:l(this).data("path"),uplevel:0,plugin:l(this).data("plugin")})}}else{l("#overlay-playsource-open").trigger("click")}});l("#db-homeSetup").click(function(){var e=l(this);if(e.hasClass("btn-primary")){e.removeClass("btn-primary").addClass("btn-default");l(".home-block-remove").remove()}else{e.removeClass("btn-default").addClass("btn-primary");l(".home-block.home-bookmark").append('<div class="home-block-remove" title="Remove this bookmark"><span class="block-remove">&times;</span></div>')}});var r=l("#database-entries");r.on("click","li",function(e){var a="",s="";var t=l(this);if(l(e.target).hasClass("db-action")){e.preventDefault();a=t.data("path");GUI.DBentry[0]=a}else{l("li.active","#database-entries").removeClass("active");t.addClass("active");if(t.hasClass("db-folder")){a=t.data("path");if(t.hasClass("db-album")){if(a!==""){getDB({path:a,uplevel:0,browsemode:"album"})}else{a=GUI.currentDBpath[GUI.currentDBpos[10]-1];getDB({path:a,uplevel:0,browsemode:"albumfilter"})}}else if(t.hasClass("db-artist")){getDB({path:a,uplevel:0,browsemode:"artist"})}else if(t.hasClass("db-composer")){getDB({path:a,uplevel:0,browsemode:"composer"})}else if(t.hasClass("db-genre")){getDB({path:a,uplevel:0,browsemode:"genre"})}else if(t.hasClass("db-dirble")){a=GUI.currentpath+"/"+t.find("span").text();var o=t.hasClass("db-dirble-child")?"stations":"childs";getDB({path:a,plugin:"Dirble",querytype:o,args:t.data("path")});GUI.plugin="Dirble"}else if(t.hasClass("db-jamendo")){}else{s=t.data("browsemode");getDB({path:a,uplevel:0,browsemode:s})}var i=t.attr("id");i=i.replace("db-","");GUI.currentDBpos[GUI.currentDBpos[10]]=i;GUI.currentDBpath[GUI.currentDBpos[10]]=a;++GUI.currentDBpos[10]}else if(t.hasClass("db-webradio-add")){l("#modal-webradio-add").modal()}}});r.on("dblclick","li",function(e){var a=l(this);if(!l(e.target).hasClass("db-action")){l("li.active","#database-entries").removeClass("active");a.addClass("active");var s=a.data("path");s=a.hasClass("db-dirble")?s.split(" | ")[1]:s;getDB({cmd:"addplay",path:s})}});l("#db-level-up").click(function(){--GUI.currentDBpos[10];var e=GUI.currentpath;if(GUI.currentDBpos[10]===0){e=""}else{if(GUI.browsemode==="file"){var a=e.lastIndexOf("/");e=a!==-1?e.slice(0,a):""}else{if(GUI.browsemode==="album"){e=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(e===""){e="Albums"}else{GUI.browsemode="artist"}}else if(GUI.browsemode==="artist"){e=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(e===""){e="Artists"}else{GUI.browsemode="genre"}}else if(GUI.browsemode==="composer"){e=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(e===""){e="Composer"}else{GUI.browsemode="artist"}}else if(GUI.browsemode==="genre"){e="Genres"}else if(GUI.browsemode==="albumfilter"){GUI.browsemode="artist";e=GUI.currentDBpath[GUI.currentDBpos[10]-1]}}}getDB({browsemode:GUI.browsemode,path:e,plugin:GUI.plugin,uplevel:1});GUI.plugin=""});l("#db-search-results").click(function(){l(this).addClass("hide");l("#db-level-up").removeClass("hide");getDB({path:GUI.currentpath})});l("a",".context-menu").click(function(){var e=l(this).data("cmd");var a=l(this).data("type");var s=GUI.DBentry[0];GUI.DBentry[0]="";switch(e){case"pl-add":sendCmd('load "'+s+'"');break;case"pl-replace":sendCmd("clear");sendCmd('load "'+s+'"');break;case"pl-addreplaceplay":sendCmd("clear");sendCmd('load "'+s+'"');sendCmd("play");break;case"pl-rename":l("#modal-pl-rename").modal();l("#pl-rename-oldname").text(s);break;case"pl-rm":l.ajax({url:"/command/?cmd=rm%20%22"+s+"%22",success:function(e){getPlaylists(e)},cache:false});break;case"pl-rem-dup":l.post("/db/?cmd=pl-rem-dup",{playlist:s});break;case"pl-rem-invalid":l.post("/db/?cmd=pl-rem-invalid",{playlist:s});break;case"pl-ashuffle":l.post("/db/?cmd=pl-ashuffle",{playlist:s},function(){getPlaylists()});break;case"wradd":s=s.split(" | ")[1];getDB({cmd:"add",path:s});break;case"wraddplay":s=s.split(" | ")[1];getDB({cmd:"addplay",path:s});break;case"wraddreplaceplay":s=s.split(" | ")[1];getDB({cmd:"addreplaceplay",path:s});break;case"wredit":l("#modal-webradio-edit").modal();l.post("/db/?cmd=readradio",{filename:s},function(e){var a=l("#webradio-edit-name");a.val(e.name);a.data("file-name",e.name);l("#webradio-edit-url").val(e.url)},"json");break;case"wrdelete":l("#modal-webradio-delete").modal();l("#webradio-delete-name").text(s.replace("Webradio/",""));break;case"wrsave":var t=s.split(" | ");l.post("/db/?cmd=addradio",{"radio[label]":t[0],"radio[url]":t[1]});break;default:getDB({cmd:e,path:s,browsemode:GUI.browsemode,querytype:a});break}});l("#webradio-add-button").click(function(){var e=l("#webradio-add-name").val();var a=l("#webradio-add-url").val();if(e===""||a===""){renderMSG([{title:"Missing fields",text:"Please fill both fields to continue",icon:"fa fa-warning"}])}else{l.post("/db/?cmd=addradio",{"radio[label]":e,"radio[url]":a},function(e){},"json");l("#modal-webradio-add").modal("hide");l("#webradio-add-name").val("");l("#webradio-add-url").val("")}});l("#webradio-edit-button").click(function(){var e=l("#webradio-edit-name");l.post("/db/?cmd=editradio",{"radio[newlabel]":e.val(),"radio[label]":e.data("file-name"),"radio[url]":l("#webradio-edit-url").val()},function(e){},"json")});l("#webradio-delete-button").click(function(){var e=l("#webradio-delete-name").text();l.post("/db/?cmd=deleteradio",{"radio[label]":e},function(e){},"json")});l("#db-firstPage").click(function(){l.scrollTo(0,500)});l("#db-prevPage").click(function(){var e=parseInt(l(window).height())-184;var a="-="+e.toString()+"px";l.scrollTo(a,500)});l("#db-nextPage").click(function(){var e=parseInt(l(window).height())-184;var a="+="+e.toString()+"px";l.scrollTo(a,500)});l("#db-lastPage").click(function(){l.scrollTo("100%",500)});l("#pl-firstPage").click(function(){l.scrollTo(0,500)});l("#pl-prevPage").click(function(){var e=parseInt(l(window).height())-184;var a="-="+e.toString()+"px";l.scrollTo(a,500)});l("#pl-nextPage").click(function(){var e=parseInt(l(window).height())-184;var a="+="+e.toString()+"px";l.scrollTo(a,500)});l("#pl-lastPage").click(function(){l.scrollTo("100%",500)});var d=document.location.toString();if(d.match("#")){l('#menu-bottom a[href="/#'+d.split("#")[1]+'"]').tab("show")}l("#menu-bottom a").on("shown",function(e){if(history.pushState){history.pushState(null,null,e.target.hash)}else{window.location.hash=e.target.hash}}).on("click",function(){if(l("#overlay-social").hasClass("open")){l(".overlay-close").trigger("click")}});if(l(".ttip").length){l(".ttip").tooltip()}FastClick.attach(document.body);l("#syscmd-poweroff").click(function(){l.post("/settings/",{syscmd:"poweroff"});toggleLoader()});l("#syscmd-reboot").click(function(){l.post("/settings/",{syscmd:"reboot"});toggleLoader()});l("#syscmd-display_off").click(function(){l.post("/settings/",{syscmd:"display_off"})});l("#sec-linux_password").keyup(function(){var e=l("#sec-linux_password").val();var a=e.replace(/\s/g,"");if(e===a&&e.length>=8&&e.length<=255){l("#security-linux_password_save").removeClass("disabled")}else{l("#security-linux_password_save").addClass("disabled")}});l("#sec-ap_password").keyup(function(){var e=l("#sec-ap_password").val();var a=e.replace(/\s/g,"");if(e&&e===a&&e.length>=8&&e.length<=63){l("#security-ap_password_save").removeClass("disabled")}else{l("#security-ap_password_save").addClass("disabled")}});l("#security-linux_password_save").click(function(){var e=l("#sec-linux_password").val();var a=e.replace(/\s/g,"");if(e===a&&e.length>=8&&e.length<=255){l.post("/settings/",{syscmd:"security",action:"linux_password_save",args:e})}l("#sec-linux_password").val("")});l("#security-linux_password_randomise").click(function(){l.post("/settings/",{syscmd:"security",action:"linux_password_randomise",args:""})});l("#security-ap_password_save").click(function(){var e=l("#sec-ap_password").val();var a=e.replace(/\s/g,"");if(e&&e===a&&e.length>=8&&e.length<=63){l.post("/settings/",{syscmd:"security",action:"ap_password_save",args:e})}});overlayTrigger("#overlay-social");overlayTrigger("#overlay-playsource");l("#playsource-mpd").click(function(){if(l(this).hasClass("inactive")){GUI.forceGUIupdate=true;l.ajax({url:"/command/?switchplayer=MPD",cache:false})}l("#overlay-playsource-close").trigger("click")});if(document.location.hostname=="localhost")l(".osk-trigger").onScreenKeyboard({draggable:true})})}else{jQuery(document).ready(function(o){"use strict";GUI.mode=checkWebSocket();playbackChannel();modalChannel();PNotify.prototype.options.styling="fontawesome";PNotify.prototype.options.stack.dir1="up";PNotify.prototype.options.stack.dir2="left";PNotify.prototype.options.stack.firstpos1=90;PNotify.prototype.options.stack.firstpos2=50;PNotify.prototype.options.stack.spacing1=10;PNotify.prototype.options.stack.spacing2=10;notifyChannel();o(".btn-cmd").click(function(){var e=o(this);commandButton(e)});o("#syscmd-poweroff").click(function(){o.post("/settings/",{syscmd:"poweroff"});toggleLoader()});o("#syscmd-reboot").click(function(){o.post("/settings/",{syscmd:"reboot"});toggleLoader()});o("#syscmd-display_off").click(function(){o.post("/settings/",{syscmd:"display_off"})});o(".selectpicker").selectpicker();if(o("#section-sources").length){if(o("#mount-type").val()==="nfs"){o("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide")}o("#mount-type").change(function(){if(o(this).val()==="cifs"||o(this).val()==="osx"){o("#mount-cifs").removeClass("disabled").children(".disabler").addClass("hide")}else{o("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide")}});o("#nas-guest").change(function(){if(o(this).prop("checked")){o("#mount-auth").addClass("disabled").children(".disabler").removeClass("hide")}else{o("#mount-auth").removeClass("disabled").children(".disabler").addClass("hide")}});o("#nas-advanced").change(function(){if(o(this).prop("checked")){o("#mount-advanced-config").removeClass("hide")}else{o("#mount-advanced-config").addClass("hide")}});o("#show-mount-advanced-config").click(function(e){e.preventDefault();if(o(this).hasClass("active")){o("#mount-advanced-config").toggleClass("hide");o(this).removeClass("active");o(this).find("i").removeClass("fa fa-minus-circle").addClass("fa fa-plus-circle");o(this).find("span").html("show advanced options")}else{o("#mount-advanced-config").toggleClass("hide");o(this).addClass("active");o(this).find("i").removeClass("fa fa-plus-circle").addClass("fa fa-minus-circle");o(this).find("span").html("hide advanced options")}});o("#usb-mount-list a").click(function(){var e=o(this).data("mount");o("#usb-umount-name").html(e);o("#usb-umount").val(e)})}if(o("#section-settings").length){o("#airplay").change(function(){if(o(this).prop("checked")){o("#airplayName").removeClass("hide");o("#airplayBox").addClass("boxed-group")}else{o("#airplayName").addClass("hide");o("#airplayBox").removeClass("boxed-group")}});o("#scrobbling-lastfm").change(function(){if(o(this).prop("checked")){o("#lastfmAuth").removeClass("hide");o("#lastfmBox").addClass("boxed-group")}else{o("#lastfmAuth").addClass("hide");o("#lastfmBox").removeClass("boxed-group")}});o("#proxy").change(function(){if(o(this).prop("checked")){o("#proxyAuth").removeClass("hide");o("#proxyBox").addClass("boxed-group")}else{o("#proxyAuth").addClass("hide");o("#proxyBox").removeClass("boxed-group")}});o("#dlna").change(function(){if(o(this).prop("checked")){o("#dlnaName").removeClass("hide");o("#dlnaBox").addClass("boxed-group")}else{o("#dlnaName").addClass("hide");o("#dlnaBox").removeClass("boxed-group")}});o("#local_browser").change(function(){if(o(this).prop("checked")){o("#local_browserName").removeClass("hide");o("#local_browserBox").addClass("boxed-group")}else{o("#local_browserName").addClass("hide");o("#local_browserBox").removeClass("boxed-group")}});o("#cdinput").change(function(){if(o(this).prop("checked")){o("#cdDetails").removeClass("hide");o("#cdBox").addClass("boxed-group")}else{o("#cdDetails").addClass("hide");o("#cdBox").removeClass("boxed-group")}});o("#dlnaTidal").change(function(){if(o(this).prop("checked")){o("#dlnaTidalName").removeClass("hide");o("#dlnaTidalBox").addClass("boxed-group")}else{o("#dlnaTidalName").addClass("hide");o("#dlnaTidalBox").removeClass("boxed-group")}});o("#dlnaGoogle").change(function(){if(o(this).prop("checked")){o("#dlnaGoogleName").removeClass("hide");o("#dlnaGoogleBox").addClass("boxed-group")}else{o("#dlnaGoogleName").addClass("hide");o("#dlnaGoogleBox").removeClass("boxed-group")}});o("#dlnaQobuz").change(function(){if(o(this).prop("checked")){o("#dlnaQobuzName").removeClass("hide");o("#dlnaQobuzBox").addClass("boxed-group")}else{o("#dlnaQobuzName").addClass("hide");o("#dlnaQobuzBox").removeClass("boxed-group")}});o("#spotifyconnect").change(function(){if(o(this).prop("checked")){o("#spotifyconnectAuth").removeClass("hide");o("#spotifyconnectBox").addClass("boxed-group")}else{o("#spotifyconnectAuth").addClass("hide");o("#spotifyconnectBox").removeClass("boxed-group")}});o("#samba").change(function(){if(o(this).prop("checked")){o("#sambaAuth").removeClass("hide");o("#sambaBox").addClass("boxed-group")}else{o("#sambaAuth").addClass("hide");o("#sambaBox").removeClass("boxed-group")}});o("#sambadetails").click(function(){o.post("/db/?cmd=sambadetails",{clientUUID:GUI.clientUUID})});o("#bluetooth").change(function(){if(o(this).prop("checked")){o("#bluetoothAuth").removeClass("hide");o("#bluetoothBox").addClass("boxed-group")}else{o("#bluetoothAuth").addClass("hide");o("#bluetoothBox").removeClass("boxed-group")}});o(".btn-file :file").on("fileselect",function(e,a,s){var t=o(this).parents(".input-group").find(":text");if(t.length){t.val(s)}else{if(s){if(s.indexOf(".tar.gz")>-1){o("#backup-file").html(' <i class="fa fa-check dx green"></i> '+s+"");o("#btn-backup-upload").prop("disabled",false)}else{o("#backup-file").html(' <i class="fa fa-times dx red"></i> not a valid backup file, must be: .tar.gx');o("#btn-backup-upload").prop("disabled",true)}}}})}if(o("#section-network").length){var e=o("#network-manual-config");if(o("#dhcp").val()==="Static"){e.removeClass("hide")}o("#dhcp").change(function(){if(o(this).val()==="Static"){e.removeClass("hide")}else{e.addClass("hide")}});o("#wifiProfiles").change(function(){if(o(this).prop("checked")){o("#wifiProfilesBox").addClass("hide")}else{o("#wifiProfilesBox").removeClass("hide")}});o("#wifiEdit").change(function(){if(o(this).prop("checked")){o("#networkConfiguration").removeClass("hide");o("#wifiEditButton").removeClass("btn-primary");o("#wifiEditButton").addClass("btn-default")}else{o("#networkConfiguration").addClass("hide");o("#wifiEditButton").removeClass("btn-default");o("#wifiEditButton").addClass("btn-primary")}})}if(o("#section-accesspoint").length){o("#accesspoint").change(function(){if(o(this).prop("checked")){o("#accesspointSettings").removeClass("hide");o("#accesspointBox").addClass("boxed-group")}else{o("#accesspointSettings").addClass("hide");o("#accesspointBox").removeClass("boxed-group")}});o("#ip-address").change(function(){var e=o("#ip-address").val().split(".");e[3]++;o("#dhcp-range").val(e.join(".")+","+e[0]+"."+e[1]+"."+e[2]+".254,24h");e[3]=255;o("#broadcast").val(e.join("."));o("#dhcp-option-dns").val(o("#ip-address").val());o("#dhcp-option-router").val(o("#ip-address").val())})}if(o("#section-mpd").length){o("#audio-output-interface").change(function(){renderMSG([{title:"Switching audio output",text:"Please wait for the config update...",icon:"fa fa-cog fa-spin",delay:5e3}]);var e=o(this).val();o.ajax({type:"POST",url:"/mpd/",data:{ao:e},cache:false})});o(".manual-edit-confirm").find(".btn-primary").click(function(){o("#mpdconf_editor").removeClass("hide");o("#manual-edit-warning").addClass("hide")});o("#mpd-gr-cb").change(function(){if(o(this).prop("checked")){o("#mpd-gr-fields").removeClass("hide");o("#grBox").addClass("boxed-group")}else{o("#mpd-gr-fields").addClass("hide");o("#grBox").removeClass("boxed-group")}})}if(o("#section-debug").length){o("#copyText").click(function(){o("#text2copy").html(document.getElementById("text2display").innerText);o("#text2copy").removeClass("hide");o("#text2copy").select();document.execCommand("copy");o("#text2copy").addClass("hide");new PNotify({title:"Copied to clipboard",text:"The debug output was copied successfully in your clipboard.",icon:"fa fa-check"})})}if(document.location.hostname=="localhost")o(".osk-trigger").onScreenKeyboard({draggable:true})});$(document).on("change",".btn-file :file",function(){var e=$(this),a=e.get(0).files?e.get(0).files.length:1,s=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[a,s])})}